YUI.add("minty_module_toolbar_fragments_reply_group",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_toolbar_fragments_reply_group={base:"{{reply_group}}",reply_group:'<button id="btn-reply-sender" class="btn onemsg reply" aria-label="{{str_reply_sender}}" title="{{str_reply_attr}}" data-action="reply_sender" tabindex="-1"> <i class="icon-reply"></i> </button> <button id="btn-reply-all" class="btn onemsg reply-all" aria-label="{{str_reply_all}}" title="{{str_reply_all_attr}}" data-action="reply_all" tabindex="-1"> <i class="icon-reply-all"></i> </button> <button id="btn-forward" class="btn onemsg forward" aria-label="{{str_forward}}" title="{{str_forward_attr}}" data-action="forward" tabindex="-1"> <i class="icon-forward"></i> </button>'};},"1.0.0");YUI.add("minty_module_toolbar_inbox_message_fresh",function(e){e.namespace("ui.Templates"),e.ui.Templates.minty_module_toolbar_inbox_message_fresh={base:'<div id="pagetoolbar" class="{{msgliststate}} msgtoolbar {{toolbarStyleClass}}" data-acctid="{{toolbar_acct_id}}"> {{from_search}} {{reply_group}} {{archiveEnabled}} {{archiveEnabled_else}} {{has_spam_button}} <button id="btn-actions" class="btn multimsg" aria-label="{{str_more_actions_attr}}" title="{{str_more_actions_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <i class="icon-more"></i> <span class="icon-text">{{str_more}}</span> <b class="icon icon-chevron-down"></b> </button> <button id="btn-prev-msg" class="btn btn-absolute btn-prev-msg hidden" aria-label="{{str_previous_msg_attr}}" title="{{str_previous_msg_attr}}" data-action="prev"> <i></i> </button> <button id="btn-next-msg" class="btn btn-absolute btn-next-msg hidden" aria-label="{{str_next_msg_attr}}" title="{{str_next_msg_attr}}" data-action="next"> <i></i> </button> {{cancellable}}</div>',from_search:'<button id="btn-back-to-search" class="btn" aria-label="{{str_srch_back}}" title="{{str_srch_back}}" data-action="closemsg" tabindex="-1"> <i class="icon-arrow-left"></i><span class="icon-text">{{str_srch_result}}</span> </button> ',reply_group:"{{minty_module_toolbar_fragments_reply_group}} ",showArchive:'<button id="btn-archive" class="btn multimsg" aria-label="{{str_archive_msg_attr}}" title="{{str_archive_msg_attr}}" data-action="archive" tabindex="-1"> <i class="icon-archive"></i><span class="icon-text">{{str_archive}}</span> </button> ',showRestore:'<button id="btn-restore" class="btn multimsg" aria-label="{{str_restore_msg_attr}}" title="{{str_restore_msg_attr}}" data-action="restore" tabindex="-1"> <i class="icon-restore-inbox"></i><span class="icon-text">{{strRestore}}</span> </button> ',archiveEnabled:'{{showArchive}} {{showRestore}} <button id="btn-move" class="btn multimsg" aria-label="{{str_move_msg_attr}}" title="{{str_move_msg_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <i class="icon-move"></i> <span class="icon-text">{{str_move}}</span> <b class="icon icon-chevron-down"></b> </button> <button id="btn-delete" class="btn multimsg" aria-label="{{str_delete_msg_attr}}" title="{{str_delete_msg_attr}}" data-action="delete" tabindex="-1"> <i class="icon-delete"></i><span class="icon-text">{{str_delete}}</span> </button> ',archiveEnabled_else:'<button id="btn-delete" class="btn multimsg" aria-label="{{str_delete_msg_attr}}" title="{{str_delete_msg_attr}}" data-action="delete" tabindex="-1"> <i class="icon-delete"></i><span class="icon-text">{{str_delete}}</span> </button> <button id="btn-move" class="btn multimsg" aria-label="{{str_move_msg_attr}}" title="{{str_move_msg_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <i class="icon-move"></i> <span class="icon-text">{{str_move}}</span> <b class="icon icon-chevron-down"></b> </button> ',spam_menu:'<button id="main-btn-spam" class="btn multimsg collapse-end-space" aria-label="{{str_spam_msg_attr}}" title="{{str_spam_msg_attr}}" data-action="{{spam_data_action}}" tabindex="-1"> <i class="icon-spam"></i><span class="icon-text">{{str_spam}}</span> </button> <button id="btn-spam" class="btn multimsg" aria-label="{{str_menu_spam_toggle_attr}}" title="{{str_menu_spam_toggle_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <b class="icon icon-chevron-down"></b> </button> ',spam_menu_else:'<button id="main-btn-spam" class="btn multimsg" aria-label="{{str_spam_conv_attr}}" title="{{str_spam_conv_attr}}" data-action="spam" tabindex="-1"> <i class="icon-spam"></i><span class="icon-text">{{str_spam}}</span> </button> ',has_spam_button:"{{spam_menu}} {{spam_menu_else}} ",cancellable:'<button id="btn-closemsg" class="btn btn-absolute btn-close-msg hidden" aria-label="{{str_close}}" title="{{str_close}}" data-action="closemsg" tabindex="-1"> <i></i> </button> '}},"1.0.0",{requires:["minty_module_toolbar_fragments_reply_group"]});
YUI.add("comms-ui-menu-base",function(e){function d(s){function M(){o._link=s.host,v=o._root=H(s.menu),o.dontFocus=s.dontFocus||!1,o.dontFocus||o._root.setAttribute("tabIndex",-1),o._evt=[],o._tmFocus=null,o._fixedMenuGroup=s.fixedMenuGroup,o._setVisibleCbk=s.setVisibleCbk,o._overlap=s.overlap||!1,o._offset=s.offset||{x:0,menuUpY:0,menuDownY:0},o.closeMenu=e.Lang.isUndefined(s.closeMenu)?!0:s.closeMenu,tt(),P(v,o._link),o.setAriaAttrs(v),G(s.keys),Z(s.enterAccel),_()}function _(e){var t=v.all("li");(e||t&&t.size()!==C||S[0]&&!S[0].inDoc())&&D(t)}function D(e){var t=e.size(),r=0,i,s,o,u,a,f;C=0,S=[];for(u=0;u<t;u++)a=e.item(u),C++,a.getStyle("display")!=="none"&&!a.ancestor().hasClass("disabled")&&(a.hasClass("disabled")?a.one(".icon-help")&&a.one(".help-text")&&S.push(a.one(".icon-help")):(f===undefined&&a.hasClass(n)&&(f=r),S.push(a),N&&(i=a.one("em"),i&&(s=i.get("childNodes"),s&&(o=s.item(0),o&&N===o.get("text")&&(T=a)))),r++));v.all("li."+n).removeClass(n),x=typeof f=="undefined"?-1:f}function P(e,t){t.set("aria-haspopup","true"),e.setAttrs({role:"menu","aria-labelledby":t.getAttribute("id"),"aria-hidden":"true"})}function H(t){var n,r=t instanceof e.Node;if(r||typeof t=="string")r?n=t:(f("body").append(t),n=f("body").get("lastChild"));return n.setStyles({position:"absolute",zIndex:u}),n}function B(e,t){var n=f("window"),r=h.getCachedWindowSize().height,i=o._fixedMenuGroup,s=null,u=o._setVisibleCbk,a="",v=t,g=o._link.getAttribute("data-menu-position"),E,S,T,N,C,L,A,O,M;if(e===o._root&&(!m||m())&&o._link.inDoc()){E=o._link.get("region");if(y)w&&(I(o._link),v=null),r>c&&(A=r-c),A<l&&(A=l),e.setStyles({maxHeight:A,overflowX:"hidden",overflowY:"auto",opacity:0}),S=q(v),b=t&&t.target||b;else{i&&(s=e.one("#"+i.menu),s.setStyle("maxHeight",i.height+"px")),e.setStyles({visibility:"hidden",display:"block",top:0,maxHeight:"none",opacity:0}),T=e.get("region").height,N=n.get("scrollTop"),O=E.top-N,M=r-(E.bottom-N),p.indexOf(g)!==-1?a=g:M>=O?a="below":T>M&&(a="above"),A=o._setMaxHeight(O,M,T,a),S=o._setPosition(E,a,T,A),e.setStyles({maxHeight:A,overflowX:"hidden",overflowY:"auto"}),s&&A<e.get("scrollHeight")&&s.setStyle("maxHeight","none"),C=h.getCachedWindowSize().width,C&&E.left+e.get("region").width>C&&(S.left="auto",S.right="0px");if(d||k)L=Math.max(E.left+E.width-e.get("region").width,0),S.left=L+"px",C>E.left+E.width&&(S.right="auto");S.visibility="visible"}u&&u(),_(),x=-1,e.setStyles(S),e.setStyle("opacity",1),o.dontFocus||e.focus()}}function j(e,t,n,r){var i={top:e.bottom,left:e.left,right:"auto"},s;return t==="below"?(o._overlap&&(i.top=e.top+o._offset.menuDownY),i.left+=o._offset.x):t==="above"?(o._overlap?s=e.bottom+o._offset.menuUpY:s=e.top,i.left+=o._offset.x,i.top=s-(n<r?n:r)+"px"):(o._overlap&&(i.top=e.top),i.left+=o._offset.x,i.top+=o._offset.menuDownY),i}function F(e,t,n,r){var i;return r==="below"?(i=t-c,i<l&&(i=l)):r==="above"?(i=e-c,i<l&&(i=l)):i=n,i}function I(t){var n=t.getXY(),r=parseInt(t.getStyle("height"),10)||20;return g=e.Lang.isNumber(r)?[n[0],n[1]+r]:n,g}function q(e){var t=o._root,n,r,i,s,u,a=15,f,l=h.getCachedWindowSize().height,c=0;return r=e?e.clientX:g[0],i=e?e.clientY:g[1],t.setStyles({display:"block",bottom:"auto",left:-1e3,right:"auto"}),f=parseInt(t.get("region").height,10),s=l-a-i<f,u=h.getCachedWindowSize().width-a-r<parseInt(t.get("region").width,10),n={top:i+c,left:r},s&&(n.top=l+c-f-a),u&&(n.left="auto",n.right=a+"px"),n}function R(e){e.setStyle("display","none"),e.removeClass(r),e.hasClass(t)&&e.removeClass(t),e!==o._root&&e.get("parentNode").removeClass(i),S[x]&&S[x].removeClass(n)}function U(t){var n;if(t){n=e.Node.getDOMNode(e.one(t)).nodeName,n=n.toUpperCase();switch(n){case"LI":return t;default:return t.ancestor("li")}}}function z(t){var n,r;n=U(t.target);if(!n)return;r=x,x=e.Array.indexOf(S,n),x>=0?J(r,x):x=r}function W(){var e;y||(e=o._link.one("a")||o._link,e&&e.focus())}function X(t){var n=x,r=t.target,i=e.one(document.activeElement),s,u;O=!0;switch(t.keyCode){case 38:case 40:t.halt(),$(t,n),s=S[x];if(!i||!i.hasClass("focus-node")){u=s&&s.one(".focus-node");if(!u||u.getStyle("display")==="none")u=s.one("a")||s;u&&u.focus()}break;case 27:o.hide(),t.halt(),W();break;case 13:e.use("node-event-simulate",function(){r.get("nodeName").toLowerCase()==="a"?(r.simulate("click"),t.halt(),o.hide()):r.hasClass("icon-help")?(r.simulate("click"),t.halt()):T&&(T.one("a").simulate("click"),o.hide())});break;default:E.length>0&&K(t)?(o.hide(t),W()):t.halt()}}function V(e){if(O){O=!1;return}switch(e.keyCode){case 38:case 40:e.halt()}}function $(e,t){e.keyCode===40?(x=x===S.length-1?0:x+1,J(t,x,!0)):e.keyCode===38&&(x=x<=0?S.length-1:x-1,J(t,x,!0))}function J(e,t,r){var i=this,s,o;if(s=S[e]){s.removeClass(n);if(!i.dontFocus){o=s.one(".focus-node");if(!o||o.getStyle("display")==="none")o=s.one("a")||s;o&&o.set("tabIndex",-1)}}if(s=S[t]){s.addClass(n);if(!i.dontFocus){o=s.one(".focus-node");if(!o||o.getStyle("display")==="none")o=s.one("a")||s;o&&(o.set("tabIndex",0),r&&o.scrollIntoView())}}}function K(t){var n,r,i,s,o,u,f;if(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey){for(s=0;s<E.length;s++)if((r=(E[s]+"").split("+"))&&r.length>1){u=0;for(o=0;o<r.length;o++){i=r[o],f=i.toLowerCase()==="cmd"?"metaKey":i.toLowerCase()+"Key";if(a.isNumber(i*1)&&i*1!==t.keyCode||!a.isNumber(i*1)&&!t[f])break;u++}if(r.length===u){n=!0;break}}}else e.Array.indexOf(E,t.keyCode)>-1&&(n=!0);return n}function Q(e){E=e}function G(e){a.isArray(e)?Q(e):a.isFunction(e)?e.call(this,Q):a.isString(e)&&Q([e])}function Z(e){e&&(a.isFunction(e)?e.call(this,et):a.isString(e)&&et([e]))}function et(e){N=e}function tt(){function t(){if(!o.isVisible())return;o.tmFocus&&o.tmFocus.cancel(),o._tmFocus=a.later(0,o,function(){try{var t=e.one("document").get("activeElement"),n=t.get("nodeName"),r;n!=="EMBED"&&n!=="OBJECT"&&(r=t.getAttribute("embed-type"),r!=="menu"&&o.hide())}catch(i){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-comms-shared-src-ui-menu-js-menu:1",i,"TRY_CATCH"
,1,1,1):window.console&&console.log&&console.log("caughterror:..-build-comms-shared-src-ui-menu-js-menu:1")}})}y?(o._evt.push(o._link.on("mousedown",function(){o.hide()},o)),o._evt.push(o._link.on("contextmenu",function(e){o.toggle(e)},o))):(o._evt.push(o._link.on("mousedown",function(e){e.halt(),o.toggle(e)},o)),o._evt.push(o._link.on("keydown",function(e){if(e.keyCode===13||e.keyCode===32)e.preventDefault(),o.toggle(e)},o))),o._evt.push(o._root.on("blur",t,o)),o._evt.push(e.on("windowresize",function(){var n=e.one("body").get("clientWidth"),r=e.one("body").get("clientHeight");if(n!==L||r!==A)L=n,A=r,t()},o)),o._evt.push(o._root.on("focus",function(){o._tmFocus&&o._tmFocus.cancel()},o)),o._evt.push(o._root.on("keydown",X,o)),o._evt.push(o._root.on("keypress",V,o)),o._evt.push(o._root.on("mouseover",z,o)),o._evt.push(o._root.on("menu:changed",function(){D(v.all("li"))}))}function nt(){return v}function rt(){return b}var o=this,d=f("body").getStyle("direction")==="rtl",v,m=s.button_enabled,g=s.xy||[0,0],y=s.isContext||!1,b=s.contextTarget||null,w=s.alignToTarget||!1,E=[],S=[],x,T=null,N=null,C=-1,k=s.flushLeft,L=e.one("body").get("clientWidth"),A=e.one("body").get("clientHeight"),O=!1;M(),e.mix(o,{setVisible:B,_setPosition:j,_setMaxHeight:F,hideMenu:R,checkDescendants:_,getMenuNode:nt,getContextTarget:rt,selectMenuItem:function(){this.simulate&&this.simulate("mouseover")},getHost:function(){return o._link}})}var t="menu-active",n="menu-active-item",r="menu-visible",i="menu-visible-path",s="role",o="aria-hidden",u=15500,a=e.Lang,f=e.one,l=80,c=40,h=e.common.Utils,p=["above","below"];d.prototype={_detachHdlr:null,setAriaAttrs:function(e){var t=this;e.all("ul").set(s,"group"),e.all("li,div,h4").each(function(e){e.get(s)||e.set(s,"presentation")});var n=e.all("a");n.set(s,"menuitem"),t.dontFocus&&n.set("tabIndex",-1)},show:function(e){var n=this,r=n._root;if(e&&e.target&&e.target.hasClass("disabled"))return;!n.isVisible()&&r._node&&(r.addClass(t),n.setVisible(r,e),r.set(o,!1),n.attachClickHdlr(!0),r.fire("menu:state",{state:"show",link:n._link,context:e&&e.context}))},hide:function(e){var t=this,n,r=t._root,i=e?e.type:null,s=e&&e.target&&h.getDataAction(e);if(t.isVisible()&&t.closeMenu){r.set(o,!0),!t.dontFocus&&(n=r.one('a[tabindex="0"]'))&&n.set("tabIndex",-1);if(!s||s.action==="menu")t.hideMenu(r),r.fire("menu:state",{state:"hide",link:t._link,origEvtType:i})}t._detachHdlr&&t.closeMenu&&t.attachClickHdlr(!1)},toggle:function(e){this[this.isVisible()?"hide":"show"](e)},attachClickHdlr:function(t){var n=this;n._detachHdlr&&(n._detachHdlr.detach(),n._detachHdlr=null);if(t===!1)return;n._detachHdlr=e.on("click",function(t){var r=t.target,i=e.Node.getDOMNode(r),s=n._link.contains(r)||n._link===r,o=!1;e.UA.webkit&&!e.UA.chrome&&i.nodeName==="UL"&&(o=!0),t.preventDefault(),!o&&!s&&(n._tmFocus&&n._tmFocus.cancel(),n._root&&n._root._node&&n.hide())},document),e.UA.webkit&&!e.UA.chrome&&n._root.on("mousedown",function(t){var n=t.target,r=e.Node.getDOMNode(n).nodeName;r!=="A"&&(n=n.ancestor("a")),n&&n.focus()})},destroy:function(){var t,n=this;n.attachClickHdlr(!1);for(t in n._evt)e.detach(n._evt[t])},isVisible:function(){var t=this._root;return!t._node&&e.one(".dummy_menu_node")&&(t=e.one(".dummy_menu_node").menu._root),t._node?t.getStyle("display")!=="none":!1}},d.NAME="Menu",d.NS="menu",e.namespace("Plugin").Menu=d},"1.0.0",{requires:["common-utils"]});
YUI.add("_shared_module_offscreen_bin_menus_loading",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_menus_loading={base:'<div role = "menu" id = "loadingMenu" class="optionMenu" aria-live="polite"> <ul> <li><a href="#"><span>{{str_galaxy_status_loading}}</span></a></li> </ul></div>'};},"1.0.0");YUI.add("common-ui-menu-helper",function(e){e.namespace("common.ui");var t=function(){function t(t,n,r){var i,s=e.one("#loadingMenu");t.menu&&t.unplug(e.Plugin.Menu),n.menu&&n.menu instanceof e.Node&&n.menu.detachAll(),n=n||{},s&&s.remove(),t.plug(e.Plugin.Menu,n),t.menuCreated=!0;if(t.menu){i=t.menu.getMenuNode(),t.menu._root.on("menu:state",function(t){e.fire("menu:display-state",{state:t.state,intl:NeoConfig.intl}),i.fire("menu:display-state",t)}),e.on("menu:display-menu-close",function(){t&&t.menu&&t.menu.hide()}),i.delegate("click",function(r){var s=e.common.Utils.getDataAction(r),o=s.action,u,a=s.node,f=r.currentTarget.one("a");if(!o||a&&a.hasClass("disabled")){r.halt();return}f&&(!f.getAttribute("href")||"#"===f.getAttribute("href"))&&r.preventDefault();if(r.target.hasClass("icon-help")){u=r.target.get("parentNode").get("parentNode").one(".help-text");if(u){e.Node(r._currentTarget).all(".help-text").each(function(e){e!==u&&e.addClass("hidden")}),u.toggleClass("hidden"),r.halt();return}}n.allowSimClick&&i._node.click(),i.fire("menuSelected",{dataAction:o,item:a});try{t.menu&&t.menu.hide(),n.isContext?i.blur():n.blur||(t.one("a")?t.one("a").focus():t.focus())}catch(l){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-common-ui-menuhelper-menuhelper:1",l,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-common-ui-menuhelper-menuhelper:1")}},"li, dd a"),e.fire("menu:created",i),!n.cbafter&&r&&r(),t.menu.show();if(!n.cbafter)return}r&&r()}function n(t,n){e.Lang.later(500,this,function(){var i=n?n.isContext?!0:!1:!1,s=t.get("region"),o=NeoConfig.isRTL,u=e.ui.Templates._shared_module_offscreen_bin_menus_loading,a=e.one("window"),f,l,c,h,p,d;if(e.one("#loadingMenu")||t.menuCreated)return;e.one("body").append(e.common.Utils.substitute(u.base,null,0,0,strings)),c=e.one("body").get("lastChild"),i?(f=n.xy||t.getXY(),l=r(t,c,f)):(c.setStyles({position:"absolute",visibility:"hidden",display:"block",top:0}),l={top:s.bottom,left:s.left,right:"auto"},h=c.get("region").height,p=a.get("scrollTop"),d=a.get("winHeight"),h>d-(s.bottom-p)&&h<s.top-p&&(l.top=s.top-h+"px"),o&&(l.left=s.left+s.width-c.get("region").width+"px"),l.visibility="visible"),l.zIndex=4e3,c.setStyles(l)})}function r(t,n,r){var i,s=r[0],o=r[1],u,a,f=15,l,c=t.get("winHeight"),h=e.one("window").get("scrollTop")||0;return n.setStyles({display:"block",bottom:"auto",left:-1e3,right:"auto",position:"absolute"}),l=parseInt(n.get("region").height,10),u=c-f-o<l,a=t.get("docWidth")-f-s<parseInt(n.get("region").width,10),i={top:o+h,left:s},u&&(i.top=c+h-l-f),a&&(i.left="auto",i.right=f+"px"),i}e.mix(this,{create:t,createLoadingMenu:n})};e.common.ui.MenuHelper=new t},"1.0.0",{requires:["common-utils","comms-ui-menu-base","_shared_module_offscreen_bin_menus_loading"]});
YUI.add("mail-ui-messagepane-warnings",function(e){function r(e,r,i){var s=window.confirm(t([n.str_warning_msg_read_form_part1,n.str_warning_msg_read_form_part2].join("  "),n));return s&&!i&&e.submit(),r&&typeof r=="function"&&r(s),!1}function i(e){return e.rel==="nofollow"?!0:strings.str_cfg_tog_exlink_alert_page?(window.open(strings.str_cfg_url_exlink_alert_page+encodeURIComponent(e),"new"),!1):(window.confirm(t([n.str_warning_msg_read_link_part1,n.str_warning_msg_read_link_part2,n.str_warning_msg_read_link_part3].join("  "),n))&&window.open(e.href),!1)}function s(e){e.warningShown||(window.alert(t([n.str_warning_msg_read_password_part1,n.str_warning_msg_read_password_part2].join("  "),n)),e.warningShown=1)}e.namespace("mail.ui");var t=e.common.Utils.substitute,n=strings;e.mail.ui.Warnings={showFormWarning:r,showLinkWarning:i,showPasswordWarning:s},window.theMainWindow=e.mail.ui.Warnings},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-ui-mailpane-read",function(e){function a(e,t,n){var r=this,i,s;n=n||r.message,s={fid:r.fid,mid:n.mid,pid:e},i=n.nonImgAttachments;for(var o=0;o<i.length;o++){var u=i[o];(u.type==="message"||u.type==="text")&&u.partId===e&&(s.filename=u.filename)}typeof t!="undefined"&&t!==""&&t!=="null"&&(s.tnefid=t),l([s])}function f(e,t,n){var r=this,i,s=[],o,u;n=n||r.message,o={image:n.imgAttachments,"non-image":n.nonImgAttachments,all:n.attachments},u=o[e]||[];for(var a=0;a<u.length;a++){var f=u[a],c={fid:r.fid,mid:n.mid,pid:f.partId},h=f.tnefId;if(f.type==="message"||f.type==="text")c.filename=f.filename;typeof h!="undefined"&&(c.tnefid=h),s.push(c)}t&&t.target&&(t.target.get("nodeName")==="A"?i={restoreFocusNode:t.target}:i={restoreFocusNode:t.target.ancestor("A")}),s.length&&l(s,i)}function l(n,r){e.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),function(){t.common.downloader.render(n,r)})}function c(){e.fire("openOptions",{view:"security"})}function h(t,n,r){var i=this,s,o;r=r||i.fid,n=n||i.message;if(n&&!i.loading_slow&&!i.loading_error&&!i.loading_moved&&!n.flags.isRead){s=e.mail.persist.MetaData.get("cg.pref.general.markasreadinterval");if(s!=="999")return s=s?parseInt(s,10)*1e3:750,isNaN(s)&&(s=750),o=s===0,NeoConfig.loadYodaController.then(function(){i.tmFireRead&&(clearTimeout(i.tmFireRead),i.tmFireRead=null),i.tmFireRead=setTimeout(function(){e.mail.controller.v3.api.flagMessagesWithMid({messages:n,sourceFid:r,flags:{read:1},showTAE:!1,statTAE:!1})},s),t&&t(null)}),!0}return!1}function p(t,n){var r={metaKey:n.metaKey,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey};e.UA.ie>=12?window.open(NeoConfig.scriptBase+"/rd?url="+window.encodeURIComponent(t.get("href"))+"&ncrumb="+NeoConfig.ncrumb):t.simulate("click",r)}function d(t){var n=t.target,r=n.get("parentNode"),i=null;n.hasAttribute("ymailto")?i=n.getAttribute("ymailto"):r.hasAttribute("ymailto")&&(i=r.getAttribute("ymailto")),i&&i.length>0&&(t.preventDefault(),e.use("mail-ui-shortcuts",function(e){e.mail.ui.ShortCuts.composeMailToMessage(i)})),n.test("a[rel=nofollow]")?(n.setAttribute("rel","noreferrer"),t.preventDefault(),p(n,t)):r.test("a[rel=nofollow]")&&(r.setAttribute("rel","noreferrer"),t.preventDefault(),p(r,t))}e.namespace("mail.ui");var t=e.mail,n=e.common.Utils,r=n.settings.value("messageReadAdRotationInterval")||3e4,i=n.settings.value("messageReadAdRotationIdleInterval")||3e5,s=function(){},o=function(){var t=this;t.cancelAdRotationTimer(),t.lastActivityTime=Date.now(),t.adRotationTimer=e.later(r,t,function(){var n=Date.now();n>t.lastActivityTime+i?t.cancelAdRotationTimer():e.fire("darlaEvent",{action:t.fullView?"message_tabpane_timed_ad":"msgread_reading_pane_timed_ad"})},null,!0)},u=function(){var e=this;e.adRotationTimer&&(e.adRotationTimer.cancel(),e.adRotationTimer=null)};e.mix(s.prototype,{bindPaneContent:function(){},onSuccess:function(){},setFullFormatters:function(){},postRender:function(){},downloadAttachment:a,downloadAllAttachments:f,loadOptions:c,markAsRead:h,handleBodyLinkClick:d,startAdRotationTimer:o,cancelAdRotationTimer:u}),e.mail.ui.MailPaneRead=s},"1.0.0",{requires:["mail-ui-common-string-utils","common-utils","common-utils-stats","mail-controller-base"]});
YUI.add("contacts-api-config",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n={1:"asc",2:"desc"},r={1:"first",3:"last",6:"email"},i=e.common.Utils,s=i.settings.value("contactsV2Limit"),o;o=function(){var t=this,i=function(e){return!!e},o={baseHost:{validator:i},uri:{},headers:{},wssid:{},guid:{},requestFn:{},wspath:{value:"/ws/sd",validator:i},start:{},count:{value:s,validator:i},sortfields:{},out:{value:"name,email,nickname,yahooid,phone,otherid,image"},prefs:{value:null},sort:{},fields:{},view:{value:["compact"]},rev:{value:0,validator:i},reloadOnUpdate:{value:!0},fieldsToProcess:{value:["name","nickname","email","yahooid","image"],validator:function(t){return e.Lang.isArray(t)}},minimumFields:{value:["name","email","phone","nickname","yahooid","otherids","company"],validator:function(t){return e.Lang.isArray(t)}}};t.addAttrs(o),t.setSortField=function(e){return t.set("sortfields",r[e]),t.get("sortfields")},t.setSortOrder=function(e){return t.set("sort",n[e]),t.get("sort")}},e.augment(o,e.Attribute),t.config=new o;if(t.clientConfig)t.config.setAttrs(t.clientConfig);else if(NeoConfig){var u={guid:NeoConfig.neoguid,wssid:NeoConfig.wssid,wspath:NeoConfig.socdirProxyPath,sortfields:"first",sort:"asc"};e.Object.getValue(e,["common","net","SessionMgr"])&&(u.requestFn=e.common.net.SessionMgr.requestProxy),t.config.setAttrs(u)}},"1.0.0",{requires:["attribute","mail-common-utils-features","mail-common-utils-settings"]});
YUI.add("contacts-api-cache",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=e.contacts.config,r,i=e.Lang,s={CONTACT_CHANGED:"contacts:api:contactChanged",CONTACTS_LOADED:"contacts:api:loaded",CONTACT_IMAGE_UPDATED:"contacts:api:imageUpdated"};t.EVENTS=s,r=function(){var t=this,r=!1,o=0,u,a={},f={},l={},c={},h=[],p=[],d=null,v,m,g,y,b,w;v=function(e,t){var n,r;t||(c={});for(n in e)e.hasOwnProperty(n)&&(r=e[n],typeof r=="object"&&(c[r.id]=c[r.id]||r,t&&(c[r.id].contacts=c[r.id].contacts||[],c[r.id].contacts.push(t.id))))},b=function(t,n){var r=a[t.id]={typedFields:{},typedFieldValues:{}},i,s,o,u,f,l;n=n||[],i=n.length>0,t.fields=t.fields||[];for(f in t){if(f==="fields")continue;if(t.hasOwnProperty(f)){s=t[f],f=w(f,s);if(i&&n.indexOf(f)===-1)continue;r.typedFields[f]||(r.typedFields[f]=[]),r.typedFieldValues[f]||(r.typedFieldValues[f]=[]);if(Array.isArray(s))for(l in s)o=s[l],u=o.ep,o&&u&&(o.value=u,o.type=f,r.typedFields[f].push(o),r.typedFieldValues[f].push(u),t.fields.push(o));else if(typeof s=="object"){if(f==="name"){if(!s.familyName||s.familyName.indexOf("<")!==-1)s.familyName="";if(!s.givenName||s.givenName.indexOf("<")!==-1)s.givenName="";if(!s.middleName||s.middleName.indexOf("<")!==-1)s.middleName=""}u=e.clone(s),s.type=f,s.value=u,r.typedFields[f].push(s),t.fields.push(s),r.typedFieldValues[f].push(u)}else typeof s=="string"&&(u=s,s={},s.type=f,s.value=u,r.typedFields[f].push(s),t.fields.push(s),r.typedFieldValues[f].push(u))}}},w=function(e,t){switch(e){case"emails":e="email";break;case"messengers":t&&t.flags&&t.flags[0]&&t.flags[0]!=="YID"?e="otherid":e="yahooid";break;case"phones":e="phone"}return e},t.loadSortPrefs=function(e,t){d||(d={}),d.sort_order=e,d.sort_field=t},t.setSortPrefs=function(n,r){t.loadSortPrefs(n,r),e.later(10,t,e.contacts.api.load,[1])},t.getSortPrefs=function(){return d},t.load=function(i){var o,p,d=n.get("fieldsToProcess"),g,y={},w=[];g=i.contacts||[],y={contacts:{},count:i.count,status:i.status,statusText:i.statusText,total:i.total},l={},h=[],f={},c={},a={};for(p=0;p<g.length;p++)o=g[p],w.push(o),b(o,d),h[p]=o.id,l[o.id]=o,m(o),v(o.categories,o);u=y,u.contacts.contact=w,u.contacts.count=u.contacts.total=w.length,r=!0,e.later(10,t,t.fire,[s.CONTACTS_LOADED])},t.removeFromCategories=function(t){var n=t.categories||[],r=n.length,i,s,o;for(i=0;i<r;i++)s=n[i].id,o=c[s].contacts,o&&o.splice(e.Array.indexOf(o,t.id),1)},t.update=function(r){var u,a,f,c,p=n.get("fieldsToProcess"),d=[],y=[],w=[],E=[],S=[],x=[],T=[],N,C;r.syncresult?(o=r.syncresult.rev,u=r.syncresult.diff.contacts,T=r.syncresult.results.contacts):i.isArray(r)?u=r:typeof r=="object"&&!r.contact?u=[r]:u=[r.contact];for(C=0;C<T.length;C+=1){a=T[C],c=a.op,f=l[a.id];switch(c){case"remove":x.push(f);break;case"add":E.push(a);break;case"update":S.push(a)}}for(C=0;C<u.length;C+=1){a=u[C],c=a.op||"add",f=l[a.id];switch(c){case"remove":f&&(g(f),h.splice(e.Array.indexOf(h,f.id),1),t.removeFromCategories(f),w.push(f));break;default:f?(g(f),y.push(a)):d.push(a),b(a,p),v(a.categories,a),l[a.id]=a,m(a)}}return N={created:d,modified:y,removed:w,createdCurrent:E,modifiedCurrent:S,removedCurrent:x},d.length||y.length?n.get("reloadOnUpdate")&&e.later(10,t,e.contacts.api.load,[1]):e.later(10,t,t.fire,[s.CONTACTS_LOADED]),e.later(10,t,t.fire,[s.CONTACT_CHANGED,N]),N},t.updateCategories=function(){var r={categories:c};n.get("reloadOnUpdate")&&e.later(10,t,e.contacts.api.load,[1]),e.later(10,t,t.fire,[s.CONTACT_CHANGED,r])},t.restoreObject=function(t){p[t]&&(l[t]=e.clone(p[t]))},m=function(e){var t,n,r,i;t=a[e.id].typedFieldValues.email;if(!t||t.length===0)return;for(i in t)t.hasOwnProperty(i)&&(n=t[i],r=n.toLowerCase(),f[r]=f[r]||[],f[r].push(e))},g=function(e){var t,n,r,i,s,o;t=a[e.id].typedFieldValues.email||[],s=e.id;for(o in t)t.hasOwnProperty(o)&&(n=t[o],i=n.toLowerCase(),r=f[i],r&&r[s]&&(r[s]=undefined))},t.isLoaded=function(){return r},t.getResponseObject=function(){return u},t.getContactsData=function(){return a},t.getContacts=function(){return l},t.getEmails=function(){return f},t.getCategories=function(){return c},t.getContactOrder=function(){return h},t.getUpdatedContacts=function(){return p},t.setUpdatedContacts=function(t){p[t]=e.clone(l[t])},t.getCurrentRevision=function(){return o},t.setCurrentRevision=function(e){o=e},t.loadTinyUserCard=function(r){var i=r.contacts.contact,o,u=n.get("fieldsToProcess"),a=[],f;for(f in i)i.hasOwnProperty(f)&&(o=i[f],b(o,u),l[o.id]=o,m(o),a.push(o));return e.later(10,t,t.fire,[s.CONTACT_IMAGE_UPDATED,a]),a},t.getContactsByBucket=function(e,t,n){var r,i=[],s,o=e+t,u,a=[];n?(s=c[n],s&&(i=s.contacts||[])):i=h||[];for(u=e;u<o;u++){r=i[u];if(!r)break;a.push(l[r])}return{contacts:a,total:i.length}},t.removeFlatContact=function(e,t){var n=a[e].flatContacts,r,i=n.length,s;for(r=0;r<i;r++){s=n[r];if(s.emailField&&s.emailField.id===t){n.splice(r,1);break}}},t.removeField=function(e,n){var r=l[e];if(r){var i=r.fields,s,o=i.length,u;for(s=0;s<o;s++){u=i[s];if(u.id===n){i.splice(s,1),u.type==="email"&&t.removeFlatContact(e,n);break}}}},y=function(){var e={broadcast:1,emitFacade:!0};t.publish(s.CONTACT_CHANGED,e),t.publish(s.CONTACTS_LOADED,e),t.publish(s.CONTACT_IMAGE_UPDATED,e)}()},e.augment(r,e.EventTarget),t.cache=new r},"1.0.0",{requires:["contacts-api-config","common-utils-stats"]});
YUI.add("contacts-api-utils",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.cache,r=function(){var t=this;t.getContactsByEmail=function(e){return!e||e===""?null:n.getEmails()[e.toLowerCase()]},t.isEmailKnown=function(e,n){var r,i;return r=t.getContactsByEmail(e),r?1:0},t.getContactById=function(e){var t;return t=n.getContacts()[e],t},t.getContactsByIds=function(e){var n,r;n=[];for(r in e)e.hasOwnProperty(r)&&n.push(t.getContactById(e[r]));return n},t.getCategoryById=function(e){var t;return t=n.getCategories()[e],t},t.areContactsLoaded=function(){return n.isLoaded()},t.getResponseObject=function(){return n.getResponseObject()},t.getContacts=function(e){var t,r={},i=n.getContacts();if(!e)return i;for(t in i)i.hasOwnProperty(t)&&i[t].id>=0&&(r[t]=i[t]);return r},t.getSmartContacts=function(){var e,t={};for(e in n.getContacts())n.getContacts().hasOwnProperty(e)&&n.getContacts()[e].id<0&&(t[e]=n.getContacts()[e]);return t},t.getAllContacts=function(){return n.getContacts()},t.getCategories=function(){return n.getCategories()},t.getContactsClone=function(e){var r={},i,s,o,u;if(e){i=n.getContactsByBucket(0,n.getContactOrder().length,e).contacts,o=i.length;while(o--)r[i[o].id]=i[o]}else{s=t.getContacts();for(u in s)r[u]=s[u]}return r},t.getFlatContacts=function(){var e=t.getContacts(),n=[],r,i,s;for(i in e)if(e.hasOwnProperty(i)){r=t.getBasicFlatContacts(e[i]);for(s in r)r.hasOwnProperty(s)&&n.push(r[s])}return n},t.getFieldsByType=function(e,t){var r=e[t];return r=r&&!Array.isArray(r)?[r]:r,n.getContactsData()[e.id].typedFields[t]||r},t.getFieldValues=function(r,i,s){var o,u,a;if(!r||!i)return null;if(s){u=t.getFieldsByType(r,i);if(u){o=[];for(a in u)u.hasOwnProperty(a)&&e.Array.indexOf(a.flags,s)&&o.push(a.value)}return o}return n.getContactsData()[r.id].typedFieldValues[i]},t.getShownContactName=function(n){var r,i,s=e.Lang.trim,o=s(n.name),u=n.email;if(t.isEmailKnown(u)){r=t.getContactsByEmail(u),i=t.getFirstFieldValue(r[0],"nickname");if(i)return i;i=t.getFirstFieldValue(r[0],"name");if(i){i=i.familyName+" "+i.givenName;if(s(i))return i}}return o||u},t.getName=function(n){var r,i,s=e.Lang.trim,o=s(n.name),u=n.email;if(t.isEmailKnown(u)){r=t.getContactsByEmail(u),i=t.getFirstFieldValue(r[0],"nickname");if(i)return i;i=t.getFirstFieldValue(r[0],"name");if(i&&i.givenName){i=i.givenName;if(s(i))return i}else if(i&&i.familyName){i=i.familyName;if(s(i))return i}return o}},t.getFirstFieldValue=function(e,n,r){return!e||!n?null:(t.getFieldValues(e,n,r)||[])[0]},t.getHigherPrecedenceFieldByType=function(e,n){function r(e,t){return e.id-t.id}if(!e)return null;var i=t.getFieldsByType(e,n)||[];return i.sort(r)[0]?i.sort(r)[0].value:null},t.getBasicFlatContacts=function(e){var r=n.getContactsData()[e.id].flatContacts,i,s,o,u;if(!r){r=[],s=t.getFieldsByType(e,"email")||[],i=t.getHigherPrecedenceFieldByType(e,"name")||{},o=s.length&&s[0]||{value:""};for(u in s)s.hasOwnProperty(u)&&r.push({firstname:i.givenName,lastname:i.familyName,middlename:i.middleName,nickname:t.getFirstFieldValue(e,"nickname"),image:t.getFirstFieldValue(e,"image"),email:s[u].value,emailField:s[u],id:e.id,isPrimary:s[u].value===o.value});n.getContactsData()[e.id].flatContacts=r}return r},t.getContactImage=function(e){var r=n.getContactsData()[e.id].image,i;return r||(i=t.getFirstFieldValue(e,"guid"),i&&(r=i.image),n.getContactsData()[e.id].image=r),r},t.getSortedFlatContacts=function(e){return t.sortFlatContacts(t.getFlatContacts(),e)},t.sortFlatContacts=function(e,t){function r(e){var t=0,n,r=e.matches,i;if(r)for(n in r)r[n].length===1&&(i=r[n][0],i.endIndex-i.startIndex===e[n].length&&t++);return t}function i(e,t,n){var r=e[n],i=t[n];return r&&i?r===i?null:r<i?-1:1:!r&&!i?null:r?-1:1}function s(e,t){var r,s;for(s in n)if(n.hasOwnProperty(s)){r=i(e,t,n[s]);if(r)return r}return 0}var n=t||["firstname","lastname","email"];return e.sort(s),e},t.getContactsCacheBucket=function(e,t,r){return n.getContactsByBucket(e,t,r)},t.getContactOrder=function(){return n.getContactOrder()},t.loadSortPrefs=function(e,t){n.loadSortPrefs(e,t)},t.getSortPrefs=function(){return n.getSortPrefs()},t.getSortedContacts=function(){var e=t.getContacts(),n=t.getContactOrder(),r=n.length,i=[],s;for(s=0;s<r;s++)i.push(e[n[s]]);return i},t.getTotalContacts=function(){return n.getContactOrder().length}};t.utils=new r},"1.0.0",{requires:["contacts-api-cache","common-utils-stats"]});
YUI.add("contacts-api-urigenerator",function(e){"use strict";function b(e,t,n){var r=e.split(" "),i,s="",o=r.length;while(o--)i=r[o],i&&(s&&(s+=";"),s+=p.replace("{field}",t).replace("{condition}",n).replace("{query}",encodeURIComponent(i.replace(/,/g,"\\,"))));return s}function w(t,n){var i={id:t.id,op:"update",fields:[],categories:[]},s=i.fields,o=t.fields||[],u=n.fields||[],a={},f,l,c,h,p;t=e.clone(t,!0),n=e.clone(n,!0),p=o.length;while(p--)a[parseInt(o[p].id,10)]=o[p];p=u.length;while(p--){c=u[p],f=parseInt(c.id,10),h=c.categories,l=a[f];if(!l)s.push({op:"add",value:c.value,type:c.type,flags:c.flags||[]}),h&&(s[s.length-1].categories=h);else{if(c.type!==l.type||!r.congruent(c.value,l.value,!1)||!r.congruent(c.flags,l.flags,!1)||!r.congruent(h,l.categories,!1))c.type==="yahooid"&&!r.congruent(h,l.categories,!1)?(s.push({op:"remove",id:l.id}),s.push({op:"add",value:c.value,type:c.type,flags:c.flags||[],categories:h})):c.type!=="Image"&&(s.push({op:"update",id:f,value:c.value,type:c.type,flags:c.flags||[]}),h&&(s[s.length-1].categories=h));delete a[f]}}for(p in a)a.hasOwnProperty(p)&&s.push({op:"remove",id:p});return i}function E(e,t){e=e||[],t=t||[];var n=[],r={},i,s,o,u;u=e.length;while(u--)r[parseInt(e[u].id,10)]=e[u];u=t.length;while(u--)i=t[u],o=i.id,s=r[o],s?delete r[o]:n.push({op:"addTo",id:o});for(u in r)r.hasOwnProperty(u)&&n.push({op:"removeFrom",id:e[u].id});return n}function S(t){var n=S.METHODS;t.path=t.wspath||"ws/sd",t.baseHost=t.baseHost||e.config.win.location.host,this.params=undefined,this.method="GET",this.rev=t.rev,this.uri=g,this.guid=t.guid,this.ymreqid=this.getYmReqId();if(!t.prefs&&!t.contactImport)switch(t.type){case n.SAVE:this.uri+=f;break;case n.REMOVE_FIELD:this.uri+=h.replace("{cid}",t.contactId);break;case n.DELETE:this.uri+=l;break;default:this.uri+=t.singleContact?h.replace("{cid}",t.id):a}else this.uri+=t.singleContact?c.replace("{guid}",t.guid).replace("{cid}",t.id):u.replace("{guid}",t.guid),t.prefs&&(this.uri+="/preferences;"),t.contactImport&&(this.uri+="/import");t.wssid=t.wssid||NeoConfig.wssid,this.init(t)}var t=e.contacts,n=t.utils,r=e.common.Utils,i=e.contacts.config,s=e.common.net.Session,o=e.Lang,u="v1/user/{guid}/contacts",a="v2/contacts/",f="v2/contact/",l="v2/contacts/trash/",c="v1/user/{guid}/contact/{cid}",h="v2/contact/{cid}",p="{field}.{condition}={query}",d="NO_YMREQID_LOADED",v={asc:1,desc:2,1:1,2:2},m={first:-10001,last:-10003,email:4,"-10001":"first","-10003":"last",4:"email",1:-10001,3:-10003,6:4},g=r.settings.value("contactProgrssURL"),y=r.getMailBoxQueryParams("array");r.features.enabled("contactsUE")?g=r.settings.value("unifiedEdgeURL")+r.settings.value("contactsUEPath")+"/":g=r.settings.value("contactProgrssURL"),S.prototype={init:function(e){var t=S.METHODS,n=e.type||t.DEFAULT;this.method="POST",e.contacts&&(e.contacts=this.getFormatedContacts(e.contacts));switch(n){case t.SAVE:this.setPOSTParams(e),this.setPOSTUri(e);break;case t.DELETE:this.setDeleteParams(e),this.setPOSTUri(e);break;case t.REMOVE_FIELD:this.setRemoveFieldParams(e);if(e.type===t.DELETE)break;this.setPOSTUri(e);break;case t.SAVE_PREFS:this.method="POST",this.setPOSTPrefsParams(e),this.setPOSTUri(e);break;case t.IMPORT_CONTACT:this.method="POST",this.setPOSTImportParams(e),this.setPOSTUri(e);break;default:this.method="GET",this.setGETUri(e)}},getYmReqId:function(){return s.genReqID?s.genReqID():d},getFormatedContacts:function(e){var t=[],n={},r,i,s,o,u;for(s in e){r=e[s];if(r.fields)for(i in r.fields)o=r.fields[i],o.type&&(o.type==="yahooid"&&!o.flags&&(o.flags=["YID"]),u=this.getFieldType(o.type),this.getFormatedContact(n,u,o));typeof r.categories=="object"&&(n.categories=r.categories),r.id&&(n.id=r.id),t.push(n)}return t},getFormatedContact:function(e,t,n){switch(t){case"emails":case"phones":case"messengers":case"links":case"addresses":e[t]=e[t]?e[t]:[],e[t].push(this.getFormatedField(t,n));break;default:e[t]=this.getFormatedField(t,n)}},getFieldType:function(e){switch(e){case"email":e="emails";break;case"yahooid":case"otherid":e="messengers";break;case"phone":e="phones"}return e},getFormatedField:function(e,t){var n={};switch(e){case"emails":case"phones":case"messengers":case"links":n.ep=t.value,t.flags&&(n.flags=t.flags),t.id&&(n.id=t.id);break;default:n=t.value}return n},getURI:function(){return this.uri},getMethod:function(){return this.method},setMethod:function(e){this.method=e},getHeaders:function(){return{"Content-Type":"text/plain; chaset=utf-8"}},setHeaders:function(e){this.headers=e},getParams:function(){return this.params},stripContact:function(e){e._data&&(e._data=undefined)},setPOSTImportParams:function(e){var t=e.contactImport;this.params={},t&&(this.params=t)},setPOSTPrefsParams:function(e){var t=e.prefs,n={},r=t.sort_order,i=t.sort_field;this.params={},t&&(r&&(n.sort_order=v[r]),i&&(n.sort_type=m[i]),this.params.preferences=n)},setPOSTParams:function(e){var t={};this.params={},e.contacts&&o.isArray(e.contacts)&&!o.isUndefined(e.contacts[0])&&(t=e.contacts[0]),this.stripContact(t),this.params=t},setPOSTUri:function(e,t){this.uri+=t===!0?"/sync?format=json":"?format=json",this.uri+="&custId=ymail&wssid="+e.wssid+"&ymreqid="+this.ymreqid+"&"+y.join("&")},setCreateListParams:function(e){var t=e.newContacts,n=e.updateContacts,r={name:e.category,op:"add",refid:"01"},i=[{refid:"01",op:"addTo"}],s={rev:this.rev,categories:[],contacts:[]},o,u,a;s.categories.push(r),a=t.length;while(a--)o=t[a],u={op:"add",fields:[{value:{givenName:o.name},type:"name",op:"add"},{value:o.email,type:"email",op:"add"}],categories:i},s.contacts.push(u);a=n.length;while(a--)u={id:n[a].id,op:"update",categories:i},s.contacts.push(u);this.params={contactsync:s}},setPUTParams:function(t){var r=t.contacts||[],i=t.categories||[],s=[],u=[],a,f,l,c,h,p,d,v;this.params={contactsync:{rev:this.rev}},d=r.length;if(d>0){while(d--){a=e.clone(r[d]);if(o.isValue(a.id)){if(!a.op||a.op!=="remove")f=n.getContactById(a.id),c=a.categories,l=f.categories,a=w(f,a),a.categories=E(l,c)}else{a.op="add"
,p=a.fields||[],v=p.length;while(v--)p[v].op="add";p=a.categories||[],v=p.length;while(v--)p[v]={op:"addTo",id:p[v].id};this.stripContact(a)}s.push(a)}this.params.contactsync.contacts=s}d=i.length;if(d>0){while(d--){h=e.clone(i[d]);if(o.isValue(h.id))throw new Error("category modification not yet implemented");h.op="add",h.contacts=n.getContactsByIds(h.contacts),u.push(h)}this.params.contactsync.categories=u}},setPUTUri:function(e){this.setPOSTUri(e,!0)},updateWSSID:function(t){var n,r=this.uri.split("?"),i=r[0],s=r.slice(1).join("?");NeoConfig.wssid=t,n=e.QueryString.parse(s),n.wssid=NeoConfig.wssid,this.uri=i+"?"+e.QueryString.stringify(n)},setGETUri:function(e){var t,n=e.fields,r,i=this.uri;if(n)for(r in n)n.hasOwnProperty(r)&&(t=n[r],t.name&&t.condition&&t.value&&(i+=";"+t.name+"."+t.condition+"="+t.value));if(e.prefs||e.contactImport)e.searchQuery&&e.searchField&&e.searchCondition&&(i+=";"+b(e.searchQuery,e.searchField,e.searchCondition)),e.count&&(i+=";count="+e.count),e.out&&(i+=";out="+e.out),e.start&&(i+=";start="+e.start),e.sortfields&&!e.sortByBest&&(i+=";sort-fields="+e.sortfields),e.sort&&!e.sortByBest&&(i+=";sort="+e.sort);i+="?format=json",e.view&&(o.isArray(e.view)?i+="&view="+e.view.join("&view="):i+="&view="+e.view),o.isValue(e.rev)&&(i+="&rev="+e.rev),e.id&&(i+="&id="+e.id),e.sortByBest&&(i+="&sortBy=best"),!e.prefs&&!e.contactImport&&(e.count&&(i+="&count="+e.count),e.start&&(i+="&start="+e.start)),i+="&custId=ymail&wssid="+e.wssid+"&ymreqid="+this.ymreqid+"&"+y.join("&"),this.uri=i},setCategoriesParams:function(e){var t=e.categories||[],n={rev:this.rev,categories:[],contacts:[]},r=[],i={},s,o=t.length;while(o--)s=t[o],s.id?s.op==="remove"?i=s:i={op:"update","new":{name:s.name},old:{id:s.id}}:i={op:"add",name:s.name},r.push(i);n.categories=r,this.params={contactsync:n}},setUpdateCategoriesParams:function(t){var n=t.categories.addTo||[],r=n.length,i=t.categories.removeFrom||[],s=i.length,o=t.contacts,u=o.length,a=[],f=[],l=[],c=1,h={rev:this.rev,categories:[],contacts:[]},p,d;p=r;while(p--)d=n[p],e.Lang.isNumber(d)?f.push({id:n[p],op:"addTo"}):(l.push({name:d,op:"add",refid:c}),f.push({refid:c,op:"addTo"}),c++);p=s;while(p--)f.push({id:i[p],op:"removeFrom"});p=u;while(p--)a.push({id:o[p],op:"update",categories:f});h.contacts=a,h.categories=l,this.params={contactsync:h}},setRemoveFieldParams:function(e){var t=this,r=!1,s=e.fieldId,o=e.contactId,u=n.getContactById(o),a=i.get("minimumFields"),f={id:o},c,p,d,v,m,g,y;u=t.getFormatedContacts([u]),c=u[0];for(m in c){d=c[m];if(m==="fields"||m==="id")continue;if(Array.isArray(d)){v=f[m]=[];for(g=0,y=d.length;g<y;g++){p=d[g];if(!p.id||p.id!==s)v.push(p),a.indexOf(m)>-1&&(r=!0)}}else typeof d=="object"&&(!d.id||d.id!==s)&&(f[m]=d,a.indexOf(m)>-1&&(r=!0))}f.id=c.id;if(!r){e.type=S.METHODS.DELETE,t.uri=t.uri.replace(h.replace("{cid}",e.contactId),l),t.init(e);return}t.params=f},setDeleteParams:function(e){var t=this,n=e.contacts,r=e.contactId,i=[],s,o;r&&i.push(r);for(o in n)s=n[o],s.id&&i.push(s.id);t.params={ids:i}}},S.METHODS={DEFAULT:0,GETCONTACTS:1,SAVE:2,DELETE:3,SAVE_CATEGORIES:4,DELETE_CATEGORIES:5,SAVE_PREFS:6,UPDATE_CONTACTS_CATEGORIES:7,REMOVE_FIELD:8,IMPORT_CONTACT:9},e.namespace("contacts"),t.URIGenerator=S},"1.0.0",{requires:["contacts-api-config","contacts-api-utils","mail-common-utils-settings","common-net-session","mail-common-utils-features"]});
YUI.add("contacts-api-io",function(e){"use strict";function i(e,t){return function(n,r){var i={};return r&&(i=e.parseJSON(r,e,t)),i==={}||i.error||!e.isSuccess(r.status)?e.failure(i,r,t):e.success(i,r,t)}}function s(e){this.io=null,this.maxRetries=2,this.retryCount=0,this.uriGenerator=t.URIGenerator,this.onSuccess=function(){},this.onFailure=function(){},this.hook=e}e.namespace("contacts");var t=e.contacts,n=e.Lang,r=e.JSON;s.prototype={parseJSON:function(t,n,r){var i=e.common.Utils.json,s;return typeof t.responseText=="string"&&t.responseText!==""?s=i.tryParse(t.responseText,function(t,i){e.fire("SplunkLog","contacts_jsonparse_error",{errorMessage:i.message,requestParams:r,responseText:t,uri:n.uriGenerator.getURI()},NeoConfig.isCorpmail?"critical":"sample")}):e.fire("SplunkLog","contacts_jsonparse_error",{errorMessage:"Contacts API returned empty or unrecognized response",requestParams:r,responseText:t,uri:n.uriGenerator.getURI()},NeoConfig.isCorpmail?"critical":"sample"),s?(s.status=t.status,s.statusText=t.statusText,s):{}},isSuccess:function(e){switch(e){case 200:case 201:case 202:case 204:return!0}return!1},doRetry:function(e){switch(e.status){case 500:return!0;case 401:if(e.getResponseHeader("WSSIdReissue"))return this.uriGenerator.updateWSSID(e.getResponseHeader("WSSIdReissue")),!0}return!1},success:function(e,t,n){this.onSuccess(e,t,n),this.retryCount=0},failure:function(t,r,i){var s=t.error&&t.error.detail&&(t.error.detail.match?t.error.detail.match(/-\d+/):null);if(("-50304"===s||!r||this.doRetry(r))&&this.retryCount<this.maxRetries)return this.retryCount+=1,e.later(100,this,function(){this.send(i)});this.retryCount=0,t.errorCode=!n.isUndefined(s)&&!n.isNull(s)?s:"-99999",this.onFailure(t,r,i)},send:function(t){var n=i(this,t),s=this,o=this.uriGenerator.getURI(),u=this.uriGenerator.getMethod(),a={data:r.stringify(this.uriGenerator.getParams()),on:{success:n,failure:n},headers:this.uriGenerator.getHeaders(),method:u==="PUT"?"POST":u,xdr:{use:"native",credentials:!0},suppressWssid:o.match("&wssid=")!==null};s.io=e.io(o,a)},abort:function(){return this.io&&typeof this.io.abort=="function"?(this.io.abort(),!0):!1}},t.sendRequest=function(e,t,n,r,i){var o=new s(r,i);return t&&(o.onSuccess=t),n&&(o.onFailure=n),e&&(o.uriGenerator=e),o.send(),o},t.Request=s},"1.0.0",{requires:["contacts-api-urigenerator","common-utils-jsonparse","json"]});
YUI.add("contacts-api-adapter",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.URIGenerator,r=t.cache,i=e.Lang,s="CONTACTS",o,u;e.common&&e.common.Utils&&(o=e.common.Utils,u=new o.Stopwatch("ContactsRequest")),t.APIAdapter={},function(){function a(e,t,s,o,f,l){function d(n){s.push(n.contact||n);if(e.length===0){var u=r.update(s);f&&i.isFunction(f)&&f(u)}else a(e,t,s,o,f,l)}function v(n){if(e.length===0&&s.length>0)r.update(s);else if(e.length>0){a(e,t,s,o,f,l);return}l&&i.isFunction(l)&&l(n)}var c=t.requestFn||null,h,p={baseHost:t.baseHost,uri:t.uri,headers:t.headers,guid:t.guid,type:n.METHODS.SAVE,wspath:t.wspath,wssid:t.wssid};o?p.contacts=o:p.contacts=[e.shift()],h=new n(p),u(h,d,v,c,{contact:p.contacts})}function f(e,t,s,o){function c(e){var t=r.update(e);s&&i.isFunction(s)&&s(t,e)}function h(e){o&&i.isFunction(o)&&o(e)}var a=t.requestFn||null,f,l={baseHost:t.baseHost,guid:t.guid,type:n.METHODS.SAVE,wspath:t.wspath,uri:t.uri,headers:t.headers,rev:r.getCurrentRevision(),wssid:t.wssid};i.isArray(e)||(e=[e]),l.contacts=e,f=new n(l),u(f,c,h,a)}var s=this,o=!1,u=t.sendRequest;s.getContact=function(s,o,a,f){function v(e){o&&i.isFunction(o)&&o(e)}function m(e){a&&i.isFunction(a)&&a(e)}var l,c,h,p,d;if(r.isLoaded()&&!f){l=r.getContacts()[s],l&&o&&i.isFunction(o)&&o({contact:l});return}c=t.config.getAttrs(),h=c.requestFn||null,p={baseHost:c.baseHost||e.config.win.location.host,uri:c.uri,headers:c.headers,guid:c.guid,wssid:c.wssid,type:n.METHODS.GETCONTACTS,start:c.start,count:c.count,sortfields:c.sortfields,out:c.out,sort:c.sort,fields:c.fields,wspath:c.wspath,view:c.view,rev:c.rev,singleContact:!0,id:s},d=new n(p),u(d,v,m,h)},s.getContacts=function(s,a,f,l){function v(t){var n,r,i="NA";t&&(n=t.getResponseHeader("X-Yahoo-Social-Host")||t.getResponseHeader("x-yahoo-social-host"),n&&(r=n.match(/\.([^\.]+)\.yahoo.com$/i),r[1]&&(i=r[1]))),NeoConfig.ABOriginColo=i,e.fire("contacts:api:origincolo",{ABOriginColo:i})}function m(e,t){var n=t.responseHeaders,s;n&&(s=n["X-Yahoo-Social-ContactsRev"]||n["X-Yahoo-Social-Contactsrev"]||n["x-yahoo-social-contactsrev"],s&&r.setCurrentRevision(parseInt(s,10))),r.load(e),v(t),a&&i.isFunction(a)&&a(r.getContacts()),o=!1}function g(e,t){o=!1,v(t),f&&i.isFunction(f)&&f(e)}if(r.isLoaded()&&!s){a&&i.isFunction(a)&&a(r.getContacts());return}var c=t.config.getAttrs(),h=c.requestFn||null,p,d={baseHost:c.baseHost||e.config.win.location.host,uri:c.uri,headers:c.headers,guid:c.guid,wssid:c.wssid,type:n.METHODS.GETCONTACTS,start:c.start,count:c.count,sortfields:c.sortfields,out:c.out,sort:c.sort,sortByBest:!!l,fields:c.fields,wspath:c.wspath,view:c.view};o&&a&&i.isFunction(a)?e.once("contacts:api:loaded",function(){a(r.getContacts())}):(o=!0,p=new n(d),u(p,m,g,h))},s.createList=function(e,s,o,a,f){function d(e){var t=r.update(e);a&&i.isFunction(a)&&a(t,e)}function v(e){f&&i.isFunction(f)&&f(e)}var l=t.config.getAttrs(),c=l.requestFn||null,h={baseHost:l.baseHost,uri:l.uri,headers:l.headers,guid:l.guid,type:n.METHODS.SAVE,wspath:l.wspath,wssid:l.wssid,rev:r.getCurrentRevision(),newContacts:e,updateContacts:s,category:o,isCreateList:!0},p=new n(h);p.setMethod("PUT"),u(p,d,v,c)},s.deleteContacts=function(e,s,o){function d(e){o&&i.isFunction(o)&&o(e)}function v(e){var t,n,o,u;if(e.status===202){t=e.syncresult.results,n=t.contacts,o=n.length;while(o--)if(n[o].error){e.errorCode=n[o].error,d(!1,e);return}}u=r.update(e),s&&i.isFunction(s)&&s(u,e)}var a=t.config.getAttrs(),f=a.requestFn||null,l=[],c=e&&i.isArray(e)?e.length:0,h={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.DELETE,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),wssid:a.wssid},p;while(c--)l.push({id:e[c],op:"remove"});h.contacts=l,p=new n(h),u(p,v,d,f)},this.getPreferences=function(e,s){function c(e){s&&i.isFunction(s)&&s(e)}function h(t,n,r){var s=t.preferences||"";e&&i.isFunction(e)&&e(s)}var o=t.config.getAttrs(),a=o.requestFn||null,f={baseHost:o.baseHost,guid:o.guid,wspath:o.wspath,uri:o.uri,headers:o.headers,rev:r.getCurrentRevision(),wssid:o.wssid,prefs:!0},l;l=new n(f),u(l,h,c,a)},this.importContact=function(e,s,o){function h(e){o&&i.isFunction(o)&&o(e)}function p(e,t,n){var r=e.preferences||"";s&&i.isFunction(s)&&s(r)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),wssid:a.wssid,type:n.METHODS.IMPORT_CONTACT,contactImport:e.contactImport},c;c=new n(l),u(c,p,h,f)},this.saveContacts=function(e,n,s){var o=t.config.getAttrs(),u=r.getCurrentRevision();u>0||!i.isArray(e)||e.length===1?f(e,o,n,s):a(e,o,[],n,s)},this.getContactsTinyUserCard=function(s,o,a){function p(e){var t=r.loadTinyUserCard(e)[0];o&&i.isFunction(o)&&o(t)}function d(e){a&&i.isFunction(a)&&a(e)}var f=t.config.getAttrs(),l=f.requestFn||null,c={baseHost:f.baseHost||e.config.win.location.host,uri:f.uri,headers:f.headers,guid:f.guid,wssid:f.wssid,type:n.METHODS.GETCONTACTS,start:0,count:1,fields:[{name:"guid",condition:"is",value:s}],wspath:f.wspath,view:"tinyusercard"},h=new n(c);u(h,p,d,l)},this.saveCategory=function(e,s,o){function h(e){var t=e.syncresult.results,n,o;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,p(!1,e);return}}o=e.syncresult.diff,r.updateCategories(e),s&&i.isFunction(s)&&s(o,e)}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_CATEGORIES,wspath:a.wspath,uri:a.uri,headers:a.headers,rev:r.getCurrentRevision(),categories:[e],wssid:a.wssid},c=new n(l);u(c,h,p,f)},this.deleteCategory=function(e,s,o){function h(e){var t=e.syncresult.results,n;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,p(!1,e);return}}r.updateCategories(e),s&&i.isFunction(s)&&s(e.syncresult.diff,e)}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.DELETE_CATEGORIES,wspath:a.wspath,uri:a.uri,headers:
a.headers,rev:r.getCurrentRevision(),categories:[{id:e,op:"remove"}],wssid:a.wssid},c=new n(l);u(c,h,p,f)},this.updateContactsCategories=function(e,s,o,a,f){function d(e){var t=e.syncresult.results,n;if(e.status===202){n=t.categories;if(n[0].error){e.errorCode=n[0].error,v(!1,e);return}}r.updateCategories(e),a&&i.isFunction(a)&&a(e.syncresult.diff,e)}function v(e,t){f&&i.isFunction(f)&&f(t)}var l=t.config.getAttrs(),c=l.requestFn||null,h={baseHost:l.baseHost,guid:l.guid,type:n.METHODS.UPDATE_CONTACTS_CATEGORIES,wspath:l.wspath,uri:l.uri,headers:l.headers,rev:r.getCurrentRevision(),categories:{addTo:s,removeFrom:o},contacts:e,wssid:l.wssid},p=new n(h);u(p,d,v,c)},this.removeField=function(e,s,o,a){function p(e){r.updateCategories(e),o&&i.isFunction(o)&&o(e.syncresult.diff,e)}function d(e,t){a&&i.isFunction(a)&&a(t)}var f=t.config.getAttrs(),l=f.requestFn||null,c={rev:r.getCurrentRevision(),contactId:e,fieldId:s,baseHost:f.baseHost,guid:f.guid,type:n.METHODS.REMOVE_FIELD,wspath:f.wspath,uri:f.uri,headers:f.headers,wssid:f.wssid},h;h=new n(c),u(h,p,d,l)},this.setSortField=function(e,s,o){function h(e){var t=e.preferences;t&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_PREFS,wspath:a.wspath,uri:a.uri,headers:a.headers,wssid:a.wssid,prefs:{sort_field:e}},c=new n(l);u(c,h,p,f)},this.restoreObject=function(e,n,i){var s=t.config.getAttrs(),o=r.getUpdatedContacts()[e];o&&f(o,s,n,i)},this.setSortOrder=function(e,s,o){function h(e){var t=e.preferences;t&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost,guid:a.guid,type:n.METHODS.SAVE_PREFS,wspath:a.wspath,uri:a.uri,headers:a.headers,wssid:a.wssid,prefs:{sort_order:e}},c=new n(l);u(c,h,p,f)},this.getSortPrefs=function(s,o){function h(e){var t=e.preferences;t&&t.sort_order&&t.sort_type&&(r.setSortPrefs(t.sort_order,t.sort_type),s&&i.isFunction(s)&&s())}function p(e){o&&i.isFunction(o)&&o(e)}if(r.getSortPrefs()){s&&i.isFunction(s)&&s(r.getSortPrefs());return}var a=t.config.getAttrs(),f=a.requestFn||null,l={baseHost:a.baseHost||e.config.win.location.host,uri:a.uri,headers:a.headers,guid:a.guid,wssid:a.wssid,type:n.METHODS.DEFAULT,wspath:a.wspath,prefs:!0},c=new n(l);u(c,h,p,f)},this.removeField=function(e,s,o,a){function p(e){r.updateCategories(e),o&&i.isFunction(o)&&o(e.syncresult.diff,e)}function d(e,t){a&&i.isFunction(a)&&a(t)}var f=t.config.getAttrs(),l=f.requestFn||null,c={rev:r.getCurrentRevision(),contactId:e,fieldId:s,baseHost:f.baseHost,guid:f.guid,type:n.METHODS.REMOVE_FIELD,wspath:f.wspath,uri:f.uri,headers:f.headers,wssid:f.wssid},h;h=new n(c),u(h,p,d,l)},this.searchContacts=function(e,r,s){function c(e){var t=e.contacts.contact||[];r&&i.isFunction(r)&&r(t)}function h(e){s&&i.isFunction(s)&&s(e)}var o=t.config.getAttrs(),a=o.requestFn||null,f={baseHost:o.baseHost,guid:o.guid,type:n.METHODS.GETCONTACTS,wspath:o.wspath,uri:o.uri,headers:o.headers,wssid:o.wssid,out:o.out,fields:o.fields,search:o.search,searchField:"all",searchCondition:"contains",searchQuery:e},l=new n(f);u(l,c,h,a)},this.createEmptyContact=function(){return{fields:[],categories:[]}}}.apply(t.APIAdapter)},"1.0.0",{requires:["contacts-api-io","contacts-api-cache","contacts-api-urigenerator","contacts-api-config","json","common-utils"]});
YUI.add("contacts-api",function(e){"use strict";e.namespace("contacts");var t=e.contacts,n=t.APIAdapter,r=t.cache,i=function(){var t=this;this.load=function(e,t,r){n.getContacts(e,t,r)},this.saveContacts=function(e,t,r){n.saveContacts(e,t,r)},this.deleteContacts=function(e,t,r){n.deleteContacts(e,t,r)},this.getPreferences=function(e,t){n.getPreferences(e,t)},this.importContact=function(e,t,r){n.importContact(e,t,r)},this.saveCategory=function(e,t,r){n.saveCategory(e,t,r)},this.deleteCategory=function(e,t,r){n.deleteCategory(e,t,r)},this.createList=function(e,t,r,i,s){n.createList(e,t,r,i,s)},this.getContacts=function(e,t,r,i){if(typeof e!="boolean")return;n.getContacts(e,t,r,i)},this.getContact=function(e,t,r,i){n.getContact(e,t,r,i)},this.createEmptyContact=function(e,t){return n.createEmptyContact(e,t)},this.getContactImage=function(e,t,r){n.getContactsTinyUserCard(e,t,r)},this.searchContacts=function(e,t,r){n.searchContacts(e,t,r)},e.on("contacts:contactChanged",function(){t.load(1)}),this.setSortOrder=function(e,t,r){n.setSortOrder(e,t,r)},this.setSortField=function(e,t,r){n.setSortField(e,t,r)},this.getSortPrefs=function(e,t){n.getSortPrefs(e,t)},this.updateContactsCategories=function(e,t,r,i,s){n.updateContactsCategories(e,t,r,i,s)},this.removeEmail=function(e,t,i,s){r.setUpdatedContacts(e),n.removeField(e,t,i,s)},this.restoreEmail=function(e,t,r){n.restoreObject(e,t,r)},this.removeEmail=function(t,i,s){r.setUpdatedContacts(t),r.removeField(t,i);var o=e.contacts.utils.getContactById(t);n.removeField(t,i),s&&s()}};t.api=new i},"1.0.0",{requires:["contacts-api-adapter","contacts-api-config","contacts-api-cache","contacts-api-utils"]});
YUI.add("mail-ui-deeplink-manager",function(e){function t(e){var t=["import_contacts","launch_compose","valentine"],r=t.map(function(e){return'[name="deeplink_'+e+'"]'}).join(",");return e.all(r).on("click",function(e){var t=e.currentTarget.get("name").replace("deeplink_","");e.halt(!0),n(t)})}function n(t){var n;NeoConfig.mrd=NeoConfig.mrd||{},NeoConfig.mrd.param=NeoConfig.mrd.param||{},t!=="valentine"&&(n=function(){e.fire("util:ymstats",{name:"deeplink",tags:{deeplinkActions:t}})});switch(t){case"launch_compose":e.fire("newMessage",{cbfn:n});break;case"import_contacts":e.fire("ws:onboarding",{type:"deeplink_import_contact",cbfn:n});break;case"valentine":n=function(){e.fire("util:ymstats",{name:"compose_valentine_autocompose",tags:{source:"deeplink"}})},e.fire("newMessage",{flavor:"autocompose",cbfn:n});break;default:}}e.namespace("mail.ui.deeplink"),e.mail.ui.deeplink.manager={attachEvents:t}},"0.1");
YUI.add("mail-ui-messagepane-read",function(e){function L(n,r){var i,s;return r&&(i=t(r.name)?t(r.name):r.email,s=v?e.contacts.utils.getShownContactName(r):i),s?o(a(s)):""}function A(e,t){return NeoConfig.bidi&&t&&t.nameDir?t.nameDir:""}function O(t){t=t||[];var n=this;if(!NeoConfig.lozenge_opi)return;if(!C){C=t;return}C=C.concat(t);try{if(C.length>0){var r={context:n,method:"POST",on:{success:function(t,r){var i=e.JSON.parse(r.responseText),s={},o,u,a,f;i=i&&i.buddyStatus;for(o in i)e.mix(s,i[o]);for(u in s)a=n.parentNode.all("[data-im="+u+"]"),f=s[u].statusCode,f===99&&(f={0:0,1:2,2:999}[s[u].dndStatus]),a.setAttribute("data-opi",f)},failure:function(){}}},i="/online/ws?m=1&p=1&t=1";r.data=e.JSON.stringify({buddiesYid:C}),e.io(i,r)}}catch(s){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-message-messagepaneread:1",s,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-message-messagepaneread:1")}finally{C=null}}function M(t){t=t.email||t;var n=e.contacts.utils.getContactsByEmail(t),r=n&&n.length>0&&e.contacts.utils.getFieldValues(n[0],"yahooid");return r&&r.length>0&&(r=r[0]),r}function _(e,n){var r="";return n&&n.name!==n.email&&(r=o(a(t(n.name)))),r}function D(e){var t=0,n=0,r=0,i=y.get("externalAccounts.extAccount")||[],s=(y.get("userSendPref.defaultID")||"").toLowerCase(),o=(y.get("userSendPref.defaultFromAddress")||"").toLowerCase(),u,a,f,l,c,h,p;for(a=0;a<e.length;a++)p=(e[a].email||"").toLowerCase(),(p===s||p===o)&&t++;if(t>0)return t;for(a=0,f=i.length;a<f;a++){u=i[a];if(u){h=(u.address||"").toLowerCase();for(l=0,c=e.length;l<c;l++)p=(e[l].email||"").toLowerCase(),p===h&&n++}}return n>0?n:r}function P(e,t){return t&&t.email?o(a(t.email)):""}function H(e){return e.length===0?0:(S<0&&(S=D(e)),S)}function B(e){return e.length===0?0:(x<0&&(x=D(e)),x)}function j(e){var t=[strings.str_conv_call_duration],n=0,r=0,i=parseInt(e,10);isNaN(i)&&(i=0);while(i>=3600)n++,i-=3600;while(i>=60)r++,i-=60;return n&&t.push(n,strings.str_conv_time_hours),r&&t.push(r,strings.str_conv_time_minutes),t.push(i,strings.str_conv_time_seconds),t.join(" ")}function F(){function c(e,t,r,s,o){var u=[],a=s?Math.min(s,e.length):e.length,f=[],c,h,p;for(c=0;c<a;c++)h=e[c],p=h.email,NeoConfig.lozenge_opi&&(h.im=M(p),h.im&&(f.push(h.im),h.opi="tbd")),u.push(l({opi:h.opi,im:h.im,s:t,o:o&&o(h),f:r,a:h}));return i=e.length,n.loadPresenceState(f),u.join("")}function p(e){return e.filename?o(a(e.filename)):""}function m(t){var n=t&&t.header?t.header.from:null,r=n?n.name:"",i=v&&n?e.contacts.utils.getShownContactName(n):r;return i}function g(t){var n=[];return e.Array.each(t.slice(N,t.length),function(e){n.push(e.email)}),n.join(",")}function b(e,t){var n;return e=e||[],n=t?null:e.length===N+1?e.length:N,n}var n=this,i=0,u=f._shared_module_message_display_fresh_rollup,l;l=function(e){var t=e.s||"",r=e.o||0,i=e.f||n.readFormatters,o=e.a||0,u=e.strs||strings;return s(t,r,i,o,u)},this.readFormatters={message_selection:function(){return NeoConfig.vertPane?n.numSelected>0&&!n.message?l({s:u.message_selection,o:{num_selected_msgs:n.numSelected}}):"":n.numSelected>0&&!n.message?l({s:u.message_selection}):""},message_selection_else:function(){return n.numSelected===1&&n.message?l({s:u.message_selection_else}):""},multiple_selected_msgs:function(){return n.numSelected>1?l({s:n.isChat()?u.page_conversation_history:u.page_conversation_history_else,o:{num_selected_msgs:n.numSelected}}):""},multiple_selected_msgs_else:function(){return n.numSelected===1?l({s:n.isChat()?u.page_conversation_history1:u.page_conversation_history_else1}):""},folder_message1:function(e){e=e||n.message;var t=e&&e.header;return t&&(t.subject||t.to&&t.to[0]||t.from.name)?l({s:u.folder_message1,o:e}):""},expanded:function(){return""},details:function(){return""},btnpos:function(){return u.btnpos},hidden4:function(){return u.hidden4},hidden5:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[];return t.length>0?"":u.hidden5},hidden6:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[];return t.length>0?"":u.hidden6},hidden7:function(){return""},hidden8:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=H(t);return r>0&&t.length>=1?"":u.hidden8},hidden9:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=H(t);return r===0?"":u.hidden9},hidden10:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[],r=B(t);return!r&&t.length>0?"":u.hidden10},hidden11:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[],r=B(t);return r&&t.length>0?"":u.hidden11},hidden12:function(e){e=e||n.message;var t=e&&e.header&&e.header.bcc||[];return t.length>0?"":u.hidden12},hidden13:function(e){e=e||n.message;var t=e&&e.header&&e.header.bcc||[],r=D(t);return!r&&t.length>0?"":u.hidden13},hidden14:function(e){e=e||n.message;var t=e&&e.header&&e.header.bcc||[],r=D(t);return r&&t.length>0?"":u.hidden14},headerto:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=e&&e.header&&e.header.cc||[],i=H(t);return i>0&&t.length-i>0||i>0&&r.length>0||i===0?strings.str_small_header_to:""},ccMore:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[],r=B(t);return r>0&&t.length-r===0?"":strings.str_small_header_more},ccPlus:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[],r=B(t);return r>0&&t.length-r>0?"+":""},bccPlus:function(e){e=e||n.message;var t=e&&e.header&&e.header.bcc||[],r=D(t);return r>0&&t.length-r>0?"+":""},toPlus:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=H(t);return r>0&&t.length-r>0?"+":""},toccPlus:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=e&&e.header&&e.header.cc||[],i=H(t)+B(r);return i>0&&t.length+r.length-i>0?"+":""},toYou:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=e&&e.header&&e.header.cc||[],i=H(t);return i>0&&t.length-i>0||i>0&&r.length>0?strings.str_small_header_you:""},toccYou:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||
[],r=e&&e.header&&e.header.cc||[],i=H(t)+B(r);return i>0?strings.str_small_header_you_accusative:""},toMore:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=H(t);return r>0&&t.length-r===0?"":strings.str_small_header_more},toccMore:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=e&&e.header&&e.header.cc||[],i=H(t)+B(r),s=t.length+r.length;return i>0&&s-i>0?strings.str_small_header_more:i===0?s===1?strings.str_small_header_recipient:strings.str_small_header_recipients:""},toCount:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=H(t);return t.length-r>0?t.length-r:""},toccCount:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=e&&e.header&&e.header.cc||[],i=H(t);return t.length+r.length-i>0?t.length+r.length-i:""},tomCount:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[];return t.length>0?t.length:""},ccCount:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[],r=B(t);return t.length-r>0?t.length-r:""},ccmCount:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[];return t.length>0?t.length:""},bccmCount:function(e){e=e||n.message;var t=e&&e.header&&e.header.bcc||[];return t.length>0?t.length:""},recip_string:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=H(t);return r===0&&t.length===1?strings.str_small_header_recipient:strings.str_small_header_recipients},cc_recip_string:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[],r=B(t);return r===0&&t.length===1?strings.str_small_header_recipient:strings.str_small_header_recipients},mail_search_enabled:function(e){return e=e||n.message,strings.str_cfg_tog_mailSearchEnabled===!1||!(e&&e.header&&e.header.subject)?"":l({s:u.mail_search_enabled})},mail_search_enabled_else:function(e){return e=e||n.message,strings.str_cfg_tog_mailSearchEnabled===!1||!(e&&e.header&&e.header.subject)?l({s:u.mail_search_enabled_else}):""},mail_search_enabled1:function(e){return e=e||n.message,strings.str_cfg_tog_mailSearchEnabled===!1||!(e&&e.header&&e.header.subject)?"":l({s:u.mail_search_enabled1})},msg_unread:function(){var e=n.message,t=e&&e.flags&&e.flags.isRead;return t?strings.str_msg_list_read:strings.str_msg_list_unread},msg_unread_click:function(){var e=n.message,t=e&&e.flags&&e.flags.isRead;return t?strings.str_msg_list_click_mark_as_unread:strings.str_msg_list_click_mark_as_read},msg_read_aria_checked:function(){var e=n.message,t=e&&e.flags&&e.flags.isRead;return t?"false":"true"},msg_flagged_aria_checked:function(){var e=n.message,t=e&&e.flags&&e.flags.isFlagged;return t?"true":"false"},msg_flagged1:function(){var e=n.message,t=e&&e.flags&&e.flags.isFlagged;return t?l({s:u.msg_flagged1}):""},anyUnread:function(){return n.message.flags.isRead?"":u.anyUnread},msg_subject:function(e){return e=e||n.message,e&&e.header&&e.header.subject?o(a(e.header.subject)):strings["str_msg-view_no_subject"]},msg_subjectDir:function(e){e=e||n.message;var t="";return e&&e.header&&e.header.subjectDir&&(t='dir="'+e.header.subjectDir+'"'),t},msg_participant:function(e){e=e||n.message;var t=e.header||{},r=t.from||{},i=(t.to||[])[0]||{};return i.email=i.email||y.get("userSendPref.defaultID")||y.get("userSendPref.defaultFromAddress"),i.name=i.name||y.get("userSendPref.defaultFromName")||i.email,c([i,r],u.msg_participant,n.toFormatters,null,n.toFormatters.genObj)},more_participants:function(e){return e&&e.header&&e.header.to&&e.header.to.length>1?l({s:u.more_participants,o:e}):""},msg_from:function(e){return e=e||n.message,o(a(m(e)))},msg_hdr_aria_label_from:function(e){return e=e||n.message,l({s:strings.str_msg_hdr_aria_label_from,o:e,f:n.readFormatters})||""},msg_display_name_dir:function(e){return A(e,e&&e.header&&e.header.from)},msg_from_address:function(e){return e=e||n.message,e&&e.header?o(a(e.header.from.email))||"":""},sender_email_address:function(e){var t,r;return e=e||n.message,t=m(e),r=e&&e.header?o(a(e.header.from.email))||"":"",t!==r?"&lt;"+r+"&gt;":""},is_contact_from:function(e){return e&&e.header&&e.header.from&&d(e.header.from.email)?l({s:u.is_contact_from,o:e}):""},is_contact_from_else:function(e){return e&&e.header&&e.header.from&&!d(e.header.from.email)?l({s:u.is_contact_from_else,o:e}):""},message_header_participants:function(e){return e=e||n.message,n.isChat(e)?l({s:u.message_header_participants,o:e,f:n.readFormatters}):""},message_header_to:function(e){e=e||n.message;var t=!n.isChat(e)&&e&&e.header&&e.header.to&&e.header.to.length;return t?l({s:u.message_header_to,o:e,f:n.toFormatters}):""},message_header_cc:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc&&e.header.cc.length;return t?l({s:u.message_header_cc,o:e,f:n.ccFormatters}):""},message_header_bcc:function(e){e=e||n.message;var t=e&&e.header&&e.header.bcc&&e.header.bcc.length;return t?l({s:u.message_header_bcc,o:e,f:n.bccFormatters}):""},message_header_linemod:function(e){e=e||n.message;var t=0;return e&&e.header&&(t+=e.header.to&&e.header.to.length>0?1:0,t+=e.header.cc&&e.header.cc.length>0?1:0,t+=e.header.bcc&&e.header.bcc.length>0?1:0),t>0&&t<2?"twolines":t===3?"fourlines":""},msg_body:function(){return l({s:u.msg_body,o:n.message})},msg_body_style:function(){return""},msg_body_bidi_default_dir:function(e){return e.conversationBody?"":NeoConfig.bidi?NeoConfig.isRTL?'dir="rtl"':'dir="ltr"':""},page_loading:function(){var e=n.message;return!e.body||n.loading_error||n.loading_moved?u.page_loading:n.loading_slow?"":""},page_loading1:function(){var e=n.message;return!e.body||n.outboundReq||n.loading_slow||n.loading_error||n.loading_moved?l({s:u.page_loading1}):""},page_loading_else:function(){return n.loading_slow||n.loading_error||n.loading_moved?"":l({s:u.page_loading_else})},loading_error_else:function(){return n.loading_error?"":l({s:u.loading_error_else})},loading_slow_else:function(){return!n.loading_slow&&!n.loading_moved?l({s:u.loading_slow_else}):""},loading_slow_msg:function(){return n.isChat(n.message)?"":l({s:u.loading_slow_msg})},loading_slow_conv:function(){return n.isChat
(n.message)?l({s:u.loading_slow_conv}):""},folder_message:function(e){return e=e||n.message,l({s:u.folder_message,o:e})},msg_blocked:function(){var t=n.message,r=t?t.imgAttachments||[]:[],i=n.inboxservices||[],s=e.common.persist.UserData.get("userUIPref.imageBlocking")==="b",o=r.length&&n.blockImages==="all",a=t&&(t.hasBlockedImages||(strings.str_cfg_tog_old_imageblock?o:o&&!h.isCertified(i)&&!(s&&t&&t.flags&&t.flags.inAddressBook)));return a?l({s:u.msg_blocked,o:t}):""},message_header_expand:function(e){return e=e||n.message,e.mid?l({s:u.message_header_expand,o:e}):""},message_header_flag:function(e){return e=e||n.message,e.mid?l({s:u.message_header_flag,o:e}):""},msg_has_photo_attachment:function(){var e=n.message,t=e?e.imgAttachments||[]:[];return t.length?l({s:u.msg_has_photo_attachment,o:e}):""},attached_photos:function(){var t=n.message,r=t?t.imgAttachments||[]:[],i=r.length,s=[],o,a,f;f=function(e,t){var n=this;n.s=e,n.o=t,n.f={image:function(){return t.thumbnailurl?l({s:u.image,o:t}):""},filename:function(){return p(t)}}};for(o=0;o<i;o++)a=r[o],n.blockImages==="all"&&!(e.common.persist.UserData.get("userUIPref.imageBlocking")==="b"&&t&&t.flags&&t.flags.inAddressBook)&&!strings.str_cfg_tog_show_imageblock_thumbnail?a.blocked_images="img":a.blocked_images_else=u.blocked_images_else,strings.str_cfg_tog_show_imageblock_thumbnail&&!a.thumbnailurl&&(a.thumbnailurl=strings.str_cfg_url_imageblock_thumbnail),s.push(l(new f(u.attached_photos,a)));return s.join("")},showAttachmentIcon:function(){var e=n.message,t=e?e.attachments||[]:[];return t.length>0?u.showAttachmentIcon:""},hasattachment:function(){var e=n.message,t=e?e.attachments||[]:[];return t.length>0?"hasattachment":""},msg_has_attachment:function(){var e=n.message,t=e?e.nonImgAttachments||[]:[];return!n.isChat(e)&&t.length?l({s:u.msg_has_attachment,o:e}):""},hide_attachments_else:function(){return l({s:u.hide_attachments_else})},attached_files:function(){var t=n.message,r=t?t.nonImgAttachments||[]:[],i=r.length,s=[],o,a,f;f=function(t,n){var r=this;r.s=t,r.o=n,r.f={image1:function(){return n.thumbnailurl?l({s:u.image,o:n}):""},type:function(){return e.mail.ui.AttachFileType.getType(n.filename)},filename:function(){return n.filename===".eml"&&(n.filename=strings.str_comp_nosubject+".eml"),p(n)}}};for(o=0;o<i;o++)a=r[o],s.push(l(new f(u.attached_files,a)));return s.join("")},has_inline_attachments:function(){return n.message.body&&n.message.body.inlineAttachments.length>0?l({s:u.has_inline_attachments}):""},inline_attachment_text:function(){var e=n.message.body.inlineAttachments,t=e.length,i=[],s=function(e){var t=e.length,n=[],r,i;for(r=0;r<t;r++)i=e[r],i.name&&(n.push(i.name),n.push(" <")),i.email&&n.push(i.email),i.name&&n.push(">"),n.push(", ");return n.pop(),o(a(n.join("")))},f={inline_from_data:function(e){return s([e.header.from])},inline_to_data:function(e){return s(e.header.to)},inline_date_data:function(e){return r.dateFormatter(new Date(e.header.receivedDate*1e3),strings.str_tog_dateformat_header_l10n)},inline_subject_data:function(e){return o(a(e.header.subject))},inline_cc_data:function(e){return s(e.header.cc)},inline_cchdr:function(e){return e.header.cc.length>0?l({s:u.inline_cchdr,o:e,f:f}):""},inlinemsg_text:function(e){return e.text||[e.body.display].join("")}},c;for(c=0;c<t;c++)i.push(l({s:u.inline_attachment_text,o:e[c].content,f:f}));return i.join("")},msg_has_attachment1:function(e){e=e||n.message;var t=e?e.attachments||[]:[];return t.length&&e.mid&&!n.isChat()?l({s:u.msg_has_attachment1}):t.length&&!n.isChat()?l({s:u.msg_has_attachment1,o:e}):""},hide_attachments_else1:function(e){return e=e||n.message,e.mid?l({s:u.hide_attachments_else1}):l({s:u.hide_attachments_else1,o:e})},msg_num_attachments:function(e){return e=e||n.message,e.attachments.length},single_attachment_string:function(e){return e=e||n.message,e.attachments.length===1?l({s:u.single_attachment_string}):""},single_attachment_string_else:function(e){return e=e||n.message,e.attachments.length===1?"":l({s:u.single_attachment_string_else})},page_conversation_timestamp_data:function(e){var t=e&&e.header&&e.header.receivedDate,i=/[\s\S]+"etype":"(\w+)"[\s\S]+/,s=e&&e.body&&e.body.display||"",o=(i.exec(s)||[])[1]||"";return o==="INSTANT"&&(o="IM"),t?l({s:u.page_conversation_timestamp_data,o:{type:strings["str_conv_"+o.toLowerCase()]||strings.str_conv_im,timestamp:r.dateFormatter(new Date(t*1e3),strings.str_tog_dateformat_conversation)},f:n.readFormatters}):""},page_message_history:function(t){if(!t.conversationBody)return t;var i=(t.header.to||[])[0]||{},s=t.header.from||{},f=i.name||e.common.persist.UserData.get("userSendPref.defaultFromName")||i.email,c=s.email==="mailbot@yahoo.com",h=s.name||s.email||"",p,d,v,m,g,y,b,w="",E=t.conversationBody.replace(/^[\s\S]*({"messages"[\s\S]+})/,"$1"),S={0:"yahoo",2:"msn"};e.later(100,null,function(){t.fid=n.fid,NeoConfig.msgrData.message=t,NeoConfig.msgrData.spam={spammedAs:i.email,spammerId:s.email}});try{y=e.JSON.parse(E).messages||[];for(v=0;d=y[v];v++){m=(c?i.name:i.email).replace(/[@%].*/,"")===d.from.replace(/[@%].*/,""),b=e.mail.common.YML.toHTML(d.yml||d.txt||"",S[d.cloud_id||0]);if(!b){if(!d.call_duration)continue;b='<span style="color: #bdbdbd; font-weight: bold; font-size: 10px;">',b+=j(d.call_duration),b+="</span>"}g=strings.str_tog_dateformat_conversation,p=d.from?d.from:m?f:h,p=o(a(p)),w+=l({s:u.page_message_history,o:{self:m?"self":"",timestamp:r.dateFormatter(new Date(d.ts*1e3),g),name:p,msg:b},f:n.readFormatters})}}catch(x){return typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-message-messagepaneread:2",x,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-message-messagepaneread:2"),E}return w},conversation_history:function(){return n.isChat(n.message)?l({s:u.conversation_history,o:n.message,f:n.readFormatters}):""},conversation_history_else:function(){return n.isChat(n.message)?"":l({s:u.conversation_history_else
,o:n.message,f:n.readFormatters})},num_selected_msgs:function(){return n.numSelected},msg_body_display:function(){return""},msg_flagged:function(){var e=n.message,t=e&&e.flags&&e.flags.isFlagged;return t?l({s:u.msg_flagged}):""},msg_flag:function(){var e=n.message,t=e&&e.flags&&e.flags.isFlagged;return t?strings.str_msg_list_flagged:strings.str_msg_list_not_flagged},msg_flag_click:function(){var e=n.message,t=e&&e.flags&&e.flags.isFlagged;return t?strings.str_msg_view_flagged_attr:strings.str_msg_view_flag_attr},received_date:function(e){return e=e||n.message,e&&e.header&&e.header.receivedDate?r.dateFormatter(new Date(e.header.receivedDate*1e3),strings.str_tog_dateformat_header_long_l10n):""},short_received_date:function(e){e=e||n.message;var t=e.header.receivedDate*1e3;return e&&e.header&&e.header.receivedDate?r.dateFormatter(new Date(t),Neo.getDateFormat(t,!1,!0)):""},msg_truncated:function(){var e=n.message;return e.body&&e.isTruncated&&!n.disableTruncate?l({s:u.msg_truncated}):""}},n.toFormatters={msg_to:function(e,t){e=e||n.message;var r=e&&e.header&&e.header.to||[],i=b(r,t);return c(r,u.msg_to,n.toFormatters,i,n.toFormatters.genObj)},more_to:function(e){e=e||n.message;var t=e&&e.header&&e.header.to||[],r=t.length;return r>N+1?l({s:u.more_to,o:{num_more_recipients:r-N,data_address:g(t)}}):""},genObj:function(e){var r=e&&d(e.email),i={msg_data_name:_(null,e),msg_to_address:P(null,e),msg_display_name_dir:A(null,e),msg_display_name:L(null,e),msg_participant_address:P(null,e),is_contact_to:r?u.is_contact_to:"",im:e.im||"",opi:e.opi||""};return i.is_contact_to_else=r?"":l({s:u.is_contact_to_else,o:i,f:n.toFormatters,a:e}),t(i.msg_data_name)===""&&(i.msg_data_name=i.msg_display_name),i},is_contact_chat:function(t,n){var r=n&&n.email,i=r&&d(n.email),s,o,a,f,l,c;if(i)return u.is_contact_chat;s=e.contacts.utils.getContacts();for(o in s){o=s.hasOwnProperty(o)&&s[o]||{},a=o.fields||[];for(f=0,l=a.length;f<l;f++){c=a[f];if(c.type==="yahooid"||c.type==="otherid"){c.value.indexOf("@")<0&&(c.value=c.value+n.email.replace(/.+(@.+)/,"$1"));if(c.value===n.email)return u.is_contact_chat}}}return""},is_contact_chat_else:function(t,r){var i=r&&r.email,s=i&&d(r.email),o,a,f,c,h,p;if(s)return"";o=e.contacts.utils.getContacts();for(a in o){a=o.hasOwnProperty(a)&&o[a]||{},f=a.fields||[];for(c=0,h=f.length;c<h;c++){p=f[c];if(p.type==="yahooid"||p.type==="otherid"){p.value.indexOf("@")<0&&(p.value=p.value+r.email.replace(/.+(@.+)/,"$1"));if(p.value===r.email)return""}}}return l({s:u.is_contact_chat_else,f:n.toFormatters,o:t,a:r})}},n.ccFormatters={msg_cc:function(e,t){e=e||n.message;var r=e&&e.header&&e.header.cc||[],i=b(r,t);return c(r,u.msg_cc,n.ccFormatters,i,n.ccFormatters.genObj)},more_cc:function(e){e=e||n.message;var t=e&&e.header&&e.header.cc||[],r=t.length;return r>N+1?l({s:u.more_cc,o:{num_more_recipients:r-N,data_address:g(t)}}):""},genObj:function(e){var n=e&&d(e.email),r={msg_data_name:_(null,e),msg_cc_address:P(null,e),msg_display_name_dir:A(null,e),msg_display_name:L(null,e),msg_to_address:P(null,e),msg_participant_address:P(null,e),is_contact_cc:n?u.is_contact_cc:"",im:e.im||"",opi:e.opi||""};return t(r.msg_data_name)===""&&(r.msg_data_name=r.msg_display_name),r.is_contact_cc_else=n?"":l({s:u.is_contact_cc_else,o:r}),r}},n.bccFormatters={msg_bcc:function(e,t){e=e||n.message;var r=e&&e.header&&e.header.bcc||[],i=b(r,t);return c(r,u.msg_bcc,n.bccFormatters,i,n.bccFormatters.genObj)},more_bcc:function(e){e=e||n.message;var t=e&&e.header&&e.header.bcc||[],r=t.length;return r>N+1?l({s:u.more_bcc,o:{num_more_recipients:r-N,data_address:g(t)}}):""},genObj:function(e){var n=e&&d(e.email),r={msg_data_name:_(null,e),msg_bcc_address:P(null,e),msg_display_name_dir:A(null,e),msg_display_name:L(null,e),msg_to_address:P(null,e),msg_participant_address:P(null,e),is_contact_bcc:n?u.is_contact_bcc:"",im:e.im||"",opi:e.opi||""};return t(r.msg_data_name)===""&&(r.msg_data_name=r.msg_display_name),r.is_contact_bcc_else=n?"":l({s:u.is_contact_bcc_else,o:r}),r}},n.setFull=1}function I(t,n,i){var s=this,o=r.Stopwatch.get("MsgInPreview")||s.stopwatch,a=t&&t.mid,f,l,c,d,v;try{o&&o.start(3,"OnSuccess"),window.clearTimeout(s.loadingTimer);if(a&&s.message&&p(s.message.mid,a)){try{s.changingRequest||(E++,w[a]?w[a]+=1:w[a]=1),u.stat("messageread","result=>success,env=>"+NeoConfig.mailEnv)}catch(m){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-message-messagepaneread:3",m,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-message-messagepaneread:3"),e.use("common-utils-error",function(){r.error.report("SuccessStatError",m,1,1,1)})}s.changingRequest=s.loading_slow=0,s.outboundReq=null,s.request=null,s.isRetrying=0,window.clearTimeout(s.slowLoad),s.inboxservices=s.message.inboxservices,t=e.clone(t),t.header.receivedDate=s.message.header.receivedDate,t.srvmap=s.message.srvmap,s.message=t,f=h.getQueryParams(t,"midRequest"),s.blockImages=f&&f.blockImages,s.fireEvent("getSuccess"),s.render(),NeoConfig.lozenge_opi&&(v=s.message.header.from.email,c=M(v),c?(d=s.parentNode.all("#msg_details span.lozenge.left[data-address="+v+"]"),d.setAttribute("data-im",c),d.setAttribute("data-opi","tbd"),s.loadPresenceState([c])):s.loadPresenceState([]))}else l=t?"permMidDifferent":"noRetrievedMsg",s.loadExtra(function(){this.onFailure({data:s.message,reason:l},i)},1);o&&o.start(3,"PostOnSuccess")}catch(m){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-message-messagepaneread:4",m,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-message-messagepaneread:4")}}function q(e,t){return function(n){i(e,b).apply(this,arguments),!t&&n.halt()}}function R(t){var n=t.target,i=r.getDataAction(t),s;i.action==="calevent"&&e.use("calendar-ui-addEvent-listener",function(e){s={id:n.getAttribute("id"),mid:n.getAttribute("mid"),fid:n.getAttribute("fid")},e.calendar.ui.addEvent
.listener.fire("addEvent",{data:s,source:"mail"})})}function U(){var t=this,n=r.Stopwatch.get("MsgInPreview")||t.stopwatch,i;n&&n.start(3,"BindPaneContent"),t.on("activeChange",function(e){r.features.enabled("messageReadAdr")&&(e.newVal?t.startAdRotationTimer():t.cancelAdRotationTimer())}),t.on("closeChange",function(){r.features.enabled("messageReadAdr")&&t.cancelAdRotationTimer()}),t.messageBound||(i=t.getRoot(),i&&(t.fireEvent("bindUI"),t._evts.push(i.delegate("keydown",function(e){e.keyCode===32&&(e.preventDefault(),e.target.simulate("click"))},".flag a")),t._evts.push(i.delegate("keydown",function(e){e.keyCode===32&&(e.preventDefault(),e.target.simulate("click"))},".unread-dot a")),t._evts.push(i.delegate("keydown",function(e){e.keyCode===13&&e.target.simulate("click")},".file-attach li")),t._evts.push(i.delegate("keydown",function(t){var n=e.UA.os,i=n==="windows"||n==="win",s=t.target,o;t.keyCode===9&&(o=t.currentTarget.one(".hidefocus"))&&(s.get("nodeName").toLowerCase()==="a"&&s.get("parentNode").hasClass("hidefocus")&&t.preventDefault(),o.removeClass("hidefocus"));if(i&&t.shiftKey&&t.keyCode===121||!i&&t.ctrlKey&&t.shiftKey&&t.altKey&&t.keyCode===77)t.preventDefault(),r.simulateContextMenu(t.target)},m,t)),t._evts.push(i.delegate("click",q("retryClick"),"#loadingpane .retry",t)),t._evts.push(i.delegate("click",R,".ycalshortcuts")),t._evts.push(i.delegate("click",q("handleClick"),function(e){var t=e.getAttribute("data-action");return t!==""},t)),t._evts.push(i.delegate("keydown",q("handleClick",!0),function(e){var t=e.getAttribute("data-action");return t!==""},t)),strings.str_cfg_tog_exlink_alert_page&&i.delegate("click",function(e){if(t.fid==="%40B%40Bulk"&&!e.target.hasAttribute("ymailto")){var n=e.target.getAttribute("href"),r=new RegExp(strings.str_cfg_regex_yahoo_link,"i");n.match(r)||(e.halt(),window.open(strings.str_cfg_url_exlink_alert_page+encodeURIComponent(n),"new"))}},".msg-body a"),t._evts.push(e.on("msgsview:movetonewfolder",function(){var n=e.mail.Tabs.getActiveTab();n&&n.widget&&n.widget.msgPane&&n.widget.msgPane===t&&t.message&&t.message.mid&&t.handleUI({action:"folder-new",tbAction:!0},t.fid,null,t.message.mid)})),t._evts.push(i.delegate("contextmenu",function(){e.fire("HoverCard:hideHoverCard")},".lozenge-static.hcard")),t.messageBound=1)),n&&n.start(3,"PostBindMessage"),i=null}function z(){var e=this,t=e.getRoot();e.messageBodyBound||(t&&t.one(g)&&t.one(g).on("click",function(t){t.stopPropagation();var n=t.target,r=n.get("parentNode");(r.get("nodeName")==="A"||n.get("nodeName")==="A")&&e.handleBodyLinkClick(t),n.hasClass("ycalshortcuts")&&R(t)}),e.messageBodyBound=1),t&&!r.features.enabled("messageReadPaneV2")&&(e.hdr=t.one(m),t.one(".base-card").on("scroll",e.scheduleScrollHandler,e)),r.features.enabled("messageReadAdr")&&t.one(T).on("scroll",r.debounce(function(){e.startAdRotationTimer()},500))}function W(){e.fire("openOptions",{view:"security"}),e.fire("mt:click",{action:"options"})}function X(t){var n=this;n.disableTruncate=1,n.href=t&&t.href,n.changeRequest({truncateAt:null},1,t&&t.cbk),e.fire("mt:click",{action:"show_fullmsg"})}function V(){this.changeRequest({midRequest:{blockImages:"none"}}),e.fire("mt:click",{action:"show_images"})}function $(e,t,n){var r=this,i=r.message;t||(i.body=i.attachments=i.imgAttachments=i.nonImgAttachments=0),r.changingRequest=1,r.loadPaneContent(104,1,e,n)}function J(){var t=this,n=t.loading_slow?20:t.loading_error;t.loading_slow=t.loading_error=t.loading_moved=0,n>0&&n<=6&&(t.numRetries=t.numRetries?t.numRetries+1:1),t.fireEvent("retry"),t.loadPaneContent(105,n),t.set("transferFocus",1),e.fire("mt:click",{action:"retry"})}function K(e){var t=this,n;switch(e){case"to":n=t.toFormatters.msg_to;break;case"cc":n=t.ccFormatters.msg_cc;break;case"bcc":n=t.bccFormatters.msg_bcc}return n&&n(t.message,!0)}function Q(){function u(e){var n,r=t.neighbors,i,s=l.controller,o=e&&e(),u;if(t.fid==="%40B%40Bulk"||t.fid==="Trash"||t.fid==="%40C%40Chats")r=null;i=r&&r.length;if(NeoConfig.hasConvView===1&&i)for(u=0;u<r.length;u++)r[u].mid=r[u].msgs[0].mid;i&&(n={fid:t.fid,msg:null,cachekey:"Neighbors",prefetch:r},t.isChat(r[0])&&(n.ovparams={displayPref:"text/json",urlDetection:!1,emailDetection:!1,annotateOption:{annotateText:"none"}}),NeoConfig.yodaReadEnabled?NeoConfig.loadYodaController.then(function(){s.v3.api.getSimpleBodyofMessages({messageList:r,sourceFid:t.fid,filter:n.ovparams,isPrefetchCall:!0,statTAE:!1,showTAE:!1})}):o?o.Messages.get(n,{suppressCodes:["*"],backgroundLogs:["*"]}):h.get(n,{suppressCodes:["*"],backgroundLogs:["*"]})),o&&o.execute({suppressCodes:["*"]})}var t=this,n=t.parentNode.one("div.tripane .content")||t.parentNode.one("div.message.content"),i,s,o;!NeoConfig.backButtonFull&&t.fullView===!0&&e.fire("initPage"),!t.outboundReq&&t.message&&t.message.body?t.markAsRead(u)||u():u(),this.message.fid=t.fid,r.features.enabled("messagereadassist")&&e.fire("MessagePane:msgReadData",t.message),r.features.enabled("messageReadAdr")&&t.startAdRotationTimer(),c.plainTextMessage(this.message.part)?(s=n.one(".msg-body"))!==null&&(o="addClass"):o="removeClass",o&&s&&s.parentNode&&(s[o]("plaintextMsg"),s.parentNode[o]("compose"),o=undefined),t.parentNode&&t.parentNode.ancestor("body")?t.neoFire("rendered",[],t.message,n,{headerClassName:"base-card-footer",insertPos:"prepend",att:{container:".base-card-footer",insertPos:"prepend"},rsvp:{container:".message-item-header .contents",insertPos:"append"}}):t.once("convAddedToDOM",function(){t.neoFire("rendered",[],t.message,n,{headerClassName:"base-card-footer",insertPos:"prepend",att:{container:".base-card-footer",insertPos:"prepend"},rsvp:{container:".message-item-header .contents",insertPos:"append"}})}),t.fullView?i="message_tabpane":i="msgread_reading_pane",r.features.enabled("selectToSearch")&&e.use("mail-ui-pane-utils-s2s",function(e){e.mail.ui.PaneUtils.handleS2S(t)}),r.features.enabled("readLinkEnhancr")&&r.features.enabled("enhancrV2")&&e.use("mail-ui-pane-utils-linkEnhancr",function(
e){e.mail.ui.PaneUtils.initializeReadLinkEnhancr(t)}),r.features.enabled("enhancrEmbedPlay")&&r.features.enabled("enhancrV2")&&e.use("mail-ui-enhancr",function(e){e.mail.ui.enhancr.enhancr.prepareEnhancrCards(t,n)}),e.fire("mt:view",{action:i}),r.features.enabled("deepLinkedMail")&&t.message&&t.message.srvmap&&t.message.srvmap.inboxService&&t.message.srvmap.inboxService==="certified-ssl"&&t._evts.push(e.mail.ui.deeplink.manager.attachEvents(t.listNode.one(".base-card-body")))}function G(e){var t=this,n="has-scrolled";e.target&&(e.target.get("scrollTop")>5?t.hdr.addClass(n):t.hdr.removeClass(n))}e.namespace("mail.ui");var t=e.Lang.trim,n=e.mail.ui._MessagePane,r=e.common.Utils,i=r.onDemand,s=r.substitute,o=r.escapeHtml,u=r.ymmastats,a=r.unescapeHtml,f=e.ui?e.ui.Templates:{},l=e.mail,c=l.ui.MessagePaneUtils,h=l&&l.Controller?l.Controller.Messages:{},p=l.model.DataStore.Messages.compareMultiVersionMids,d=c.isKnownEmailAddress,v=strings.str_cfg_tog_show_contact_name&&e.contacts&&e.contacts.utils,m=".message-header",g=".msg-body.inner",y=e.common.persist.UserData,b="mail-ui-messagepane-bind",w={},E=0,S=-1,x=-1,T=".base-card",N=r.settings.value("recipientThresholdVal")||5,C,k=function(e){var t=this;e=e||{},k.superclass.constructor.call(t,e)};e.extend(k,l.ui.MailPaneRead,{setFullFormatters:F,onSuccess:I,bindPaneContent:U,loadOptions:W,retryLoad:J,unblockImages:V,viewFullMsg:X,scrollNodeSelector:T,changeRequest:$,searchRecipients:D,postRender:Q,getAllLozenges:K,bindBodyContent:z,loadPresenceState:O,scheduleScrollHandler:G}),e.mix(n.prototype,k.prototype),e.mix(n.prototype,l.ui.MailPaneRead.prototype)},"1.0.0",{requires:["common-persist-user-data","mail-persist-meta-data","mail-ui-messagepane-warnings","mail-ui-mailpane-read","mail-ui-pane-utils","contacts-api","contacts-api-utils","common-utils-stats","mail-ui-messagepane-utils","mod-conversation-history_css","mail-ui-attachment-filetype","common-ui-tabs-base","mail-common-utils-settings","ymma-stats","mail-ui-deeplink-manager"]});
YUI.add("mail-common-precache-unread",function(C){C.namespace("mail.ui");var A=C.mail,E=A.ui.MessageList,D=A.model.DataStore.Messages,B="UnreadCG";NeoConfig.preCacheAlgorithm=B;E.getNeighbors=function(I,J,Q,F,K){if(!(I&&I.length&&J>=-1&&J<=I.length-1)){return;}var U=I[J],M=U?D.isCached(F,U.mid):false,L=NeoConfig.prefetchMsgsCheckMail===1,O=K||(L?4:(M?4:2)),V=[],P=[],H=[],W=1,T=0,G=0,S=K||2,R=1;if(!L&&!M){}function N(X){var Y;if((Y=I[X])&&!D.isCached(F,Y.mid)){if(Y&&Y.flags&&Y.flags.isRead===0){V.push(Y);}else{P.push(Y);}return 1;}return 0;}while(W){if(G<S&&!N(J-R)){G++;}if(T<S&&!N(J+R)){T++;}W=((V.length+P.length)<O)&&!(G===S&&T===S);R++;if(R>100){break;}}H=V.concat(P);H=H.splice(0,H.length>=O?O:H.length);for(R=0;R<H.length;R++){Q.push(H[R]);}};},"1.0.0",{requires:["mail-ui-messagelist-base"]});