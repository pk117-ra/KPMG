YUI.add("mail-ui-unverified-address-alert",function(e){"use strict";function f(){var e;return r.enabled("unverifiedAutoFwdAccountsCallout",!1)?(e=n.getPrimaryAccount(),e.forwardEmail&&!e.forwardEmailVerified?[{account:e,status:"pending",type:"forward"}]:[]):[]}function l(){var e=[],t;return r.enabled("unverifiedSendOnlyAccountsCallout",!1)?(t=n.getAccountsByType("SENDAS"),t.forEach(function(t){t.accountVerified||e.push({account:t,status:"pending",type:"sendonly"})}),e):[]}function c(){var e=0,t;for(t=0;t<s.length;t++)if(s[t].status==="pending"){s[t].status="inprogress",h(s[t]),e=1;break}if(!e){w();return}}function h(t){var n=e.one("#shellcontent"),r=Math.round(n.get("offsetWidth")/2),i=t.account.email,s=strings.str_unverified_sendonly_hd,u=strings.str_unverified_sendonly_bd,a;t.type==="forward"&&(i=t.account.forwardEmail,s=strings.str_unverified_forward_hd,u=strings.str_unverified_forward_bd),a='<div class="unverified-email">'+e.common.Utils.escapeHtml(i)+"</div>",e.mail.ui.Onboarding.showDefaultOnboarding({name:"unverifiedDlg",node:n,classNames:["unverified-acct-dlg"],dontCloseOnActions:!0,hdText:s,bdText:u.replace("{{email}}",a)+o,btnPrimaryText:strings.str_unverified_account_primary_btn,btnCancelText:strings.str_unverified_account_secondary_btn,offset:[r-200,0],onSuccess:function(){y(),m(t.account.id),d(t)},onCancel:function(){m(t.account.id),t.type==="forward"?p(t):g(t),e.mail.ui.Onboarding.closeDefaultOnboarding("unverifiedDlg"),c()},onClose:function(){m(t.account.id),c()}})}function p(t){e.use("mail-controller-v3",function(){var n="fwd_address_remove_stat",r=t.account.id;e.mail.controller.v3.api.removeFwdEmailAddress({accountId:r,accountType:t.account.type,success:function(t){t.accounts&&t.accounts.update[0].success?e.fire("util:ymstats",{name:n,tags:{status:"success"}}):e.fire("util:ymstats",{name:n,tags:{status:"failure"}})},failure:function(){e.fire("util:ymstats",{name:n,tags:{status:"failure"}})}})})}function d(t){e.use("mail-controller-v3",function(){var n="unverified_acct_resend",r=t.account.id,i=t.type;e.mail.controller.v3.api.resendVerificationEmail({accountId:r,accountType:t.account.type,success:function(t){t.accounts&&t.accounts.update[0].success?(e.one(".scout-unverifiedDlg .notificationMsg").setHTML(strings.str_unverified_account_verify_success),e.fire("util:ymstats",{name:n,tags:{status:"success",type:i}})):e.fire("util:ymstats",{name:n,tags:{status:"failure",type:i}}),v()},failure:function(){e.fire("util:ymstats",{name:n,tags:{status:"failure",type:i}}),v()}})})}function v(){setTimeout(function(){e.mail.ui.Onboarding.closeDefaultOnboarding("unverifiedDlg"),c()},i)}function m(e){s=s.filter(function(t){return e?t.account.id!==e:t.status!=="inprogress"})}function g(t){e.use("mail-controller-v3",function(){var n="unverified_acct_delete",r=t.account.id,i=t.type;e.mail.controller.v3.api.deleteAccount({accountId:r,success:function(t){t.accounts&&t.accounts.remove[0].success?e.fire("util:ymstats",{name:n,tags:{status:"success",type:i}}):e.fire("util:ymstats",{name:n,tags:{status:"failure",type:i}})},failure:function(){e.fire("util:ymstats",{name:n,tags:{status:"failure",type:i}})}})})}function y(){e.all(".scout-unverifiedDlg .callout-actions button").addClass("disabled")}function b(){e.fire("scout:suspend")}function w(){e.fire("scout:resume")}var t=e.mail,n=t.model.DataStore.Accounts,r=e.common.Utils.features,i=2e3,s=[],o="<div class='notificationMsg'></div>",u=!0,a;a=function(){var t;s=l(),t=f(),t.length&&s.unshift(t[0]),s.length&&(e.fire("util:ymstats",{name:"unverified_accounts",tags:{fwd:t.length,snd:s.length-t.length}}),u||(c(),b()))},e.namespace("mail.ui.onboarding").unverifiedAddressDlg=new a},"1.0.0",{requires:["common-utils","mail-ui-onboarding","mail-model-datastore","mail-common-utils-features"]});
